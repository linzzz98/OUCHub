PCA（主成分分析）
=====================================

如果测量两个变量，将数据绘制到二维XY图上：变量1是x轴，变量2是y轴。

如果添加第三个变量，则将图变为XYZ三维。再添加变量则无法绘制数据。

.. figure:: 1.jpg
   :figclass: align-center
   :scale: 50%

两个变量为例，通过x，y轴的平均值得到中心点，移动数据使得中心位于图形的原点（0，0）。

.. note::
   移动数据不会改变数据点之间的相对位置。

尝试拟合数据： 绘制一条穿过原点的随机线，然后旋转直到尽可能的拟合数据。

**PCA如何判定拟合度的高低？**

为了量化线拟合数据的程度，PCA将数据投影到该线上。然后可以测量数据到线的距离并尝试找到使这些距离最小的线，或者找到使投影点到原点的距离最大的线。（两者等价：|:point_right:| b与c逆相关)

.. figure:: 2.jpg
   :figclass: align-center


直观的讲，最小化b 即点到线的距离是合理的，但是实际上最大化c 即投影点到原点的距离更容易计算。

.. important::
   PCA找到拟合线是通过最大化从投影点到原点的距离的平方和。

记录下所有点到线上的投影点到原点的距离，然后计算所有距离的平方。然后将这些开平方的距离求和等于平方距离的总和（SSD)

然后不断旋转，直到得到一条有最大投影点到原点距离平方和的线————这条线称为 ``PC1``

.. note::
   假设PC1的斜率为0.25，即沿着变量1轴向外移动4个单位，沿变量2轴向上移动1个单位。这意味着数据大部分沿着变量1轴分布。

   .. figure:: 3.jpg
      :figclass: align-center

   通过勾股定理，算得原点到该点的距离为4.12

   使用SVD计算PCA时， PC1被缩放，使长度为1

   .. figure:: 4.jpg
      :figclass: align-center

   这时虽然数据被缩放，但比率仍然相同

.. important::

   PC1 = 4个变量1 和 1个变量2组成 （|:point_right:| 变量1 和 变量2 的 ``线性组合``）

   单位长的向量 = 0.97个变量1 和 0.24个变量2组成（|:point_right:| PC1的 ``奇异向量`` 或 ``特征向量``）

   基因的比例 0.97 ： 0.24（|:point_right:| ``载荷得分``）

   最佳拟合线距离的平方和（|:point_right:| PC1的 ``特征值``）

   PC1特征值的平方根（|:point_right:| PC1的 ``奇异值``）


得到与PC1的直线垂直且过原点的直线为 ``PC2``

旋转所有的内容，使得PC1呈水平状态。然后通过PC1和PC2上的投影点作为变量的（x,y）坐标，定位PCA图中的样本位置。

.. figure:: 5.jpg
   :figclass: align-center
   :scale: 50%

一旦确定了所有的主成分，就可以用特征值 即距离的平方和来确定每个PC占的差异率。

.. figure:: 6.jpg
   :figclass: align-center
   :scale: 50%

可以看到PC1和PC2占了绝大多数差异，意味着只用PC1和PC2的2d图形可以很好的近似该3d图形（94%）

将3d图转换成2d的PCA图，仅保留数据和PC1和PC2。然后将样本投影到PC1和PC2，然后旋转，使PC1水平（PC2垂直）同上定位样本位置。

.. caution::

   .. figure:: 7.jpg
      :figclass: align-center

   如果碎石图中PC3和PC4占差异相当大的比例，那么仅用前两个PC不能很精确的代表数据。

   .. figure:: 8.jpg
      :figclass: align-center
      :scale: 70%

   但是这样不清晰的PCA图也能识别数据簇，这些样本彼此之间的相似性仍然高于其他样本。