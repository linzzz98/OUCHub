<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¹¶å‘ &mdash; OUCHub  æ–‡æ¡£</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/twemoji.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"></script>
        <script src="../../../../../_static/twemoji.js"></script>
        <script src="../../../../../_static/translations.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../../../../../genindex.html" />
    <link rel="search" title="æœç´¢" href="../../../../../search.html" />
    <link rel="next" title="Sleep å’Œ Wait çš„åŒºåˆ«" href="sleepvswait.html" />
    <link rel="prev" title="HashMap" href="../collection/hashmap/hashmap.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
            <a href="../../../../../index.html" class="icon icon-home"> OUCHub
            <img src="../../../../../_static/logo_1.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="åœ¨æ–‡æ¡£ä¸­æœç´¢" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">åŸºç¡€çŸ¥è¯†</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../knowledge/k_MH.html">ğŸ’Š Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../knowledge/k_CV.html">ğŸ¤ Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../knowledge/k_ML.html">ğŸ Machine Learning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">è®ºæ–‡å­¦ä¹ </span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../paper/p_sfm.html">ğŸŠ Structure from Motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../paper/p_slam.html">ğŸŠ SLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../paper/p_pointcloud.html">ğŸ‹ Point Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../paper/p_BA.html">ğŸŠ Bundle Adjustment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../paper/p_others.html">ğŸ’ Others</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">æºç è§£æ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/colmap.html">ğŸ‘ Colmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/theiasfm.html">ğŸ‘ TheiaSfM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/ba.html">ğŸ‘ Bundle Adjustment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ç®—æ³•å­¦ä¹ </span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../algorithm/algorithm.html">ğŸ‘ Algorithm</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">å·¥ä½œçŸ¥è¯†</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../work.html">ğŸ‘ Work</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../basic.html">ğŸ‘ Algorithm</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../java.html">ğŸ‘ Algorithm</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../s3/s3.html">String,StringBuffer,StringBuilderçš„åŒºåˆ«</a></li>
<li class="toctree-l4"><a class="reference internal" href="../collection/hashmap/hashmap.html">HashMap</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">å¹¶å‘</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id2">çº¿ç¨‹æ± </a><ul>
<li class="toctree-l6"><a class="reference internal" href="#threadpoolexecutor">ThreadPoolExecutoræ„é€ æ–¹æ³•</a></li>
<li class="toctree-l6"><a class="reference internal" href="#id3">çº¿ç¨‹æ± çš„å·¥ä½œé¡ºåº</a></li>
<li class="toctree-l6"><a class="reference internal" href="#id4">æäº¤ä»»åŠ¡çš„æ–¹å¼</a></li>
<li class="toctree-l6"><a class="reference internal" href="#id5">å¦‚ä½•æ­£ç¡®ä½¿ç”¨çº¿ç¨‹æ± </a></li>
<li class="toctree-l6"><a class="reference internal" href="#id6">è·å–å¤„ç†ç»“æœå’Œå¼‚å¸¸</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#id7">çº¿ç¨‹æ± çš„å¸¸ç”¨åœºæ™¯</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#id8">æ­£ç¡®æ„é€ çº¿ç¨‹æ± </a></li>
<li class="toctree-l6"><a class="reference internal" href="#id9">è·å–å•ä¸ªç»“æœ</a></li>
<li class="toctree-l6"><a class="reference internal" href="#id10">è·å–å¤šä¸ªç»“æœ</a></li>
<li class="toctree-l6"><a class="reference internal" href="#id11">å•ä¸ªä»»åŠ¡çš„è¶…æ—¶æ—¶é—´</a></li>
<li class="toctree-l6"><a class="reference internal" href="#id12">æ€»ç»“</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="sleepvswait.html">Sleep å’Œ Wait çš„åŒºåˆ«</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/instance/instance.html">å•ä¾‹æ¨¡å¼</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../mysql/mysql.html">ğŸ‘ Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ssm/ssm.html">SSM</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">æ‚ä¸ƒæ‚å…«</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../others/o_others.html">ğŸº Others</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">OUCHub</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../work.html">ğŸ‘ Work</a> &raquo;</li>
          <li><a href="../../basic.html">ğŸ‘ Algorithm</a> &raquo;</li>
          <li><a href="../java.html">ğŸ‘ Algorithm</a> &raquo;</li>
      <li>å¹¶å‘</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/pages/work/basic/java/thread/thread.rst.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>å¹¶å‘<a class="headerlink" href="#id1" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h1>
<p>JAVAçº¿ç¨‹å¯ä»¥åˆ†ä¸ºå…­ç§çŠ¶æ€</p>
<figure class="align-center align-default">
<img alt="../../../../../_images/164.jpg" src="../../../../../_images/164.jpg" />
</figure>
<section id="id2">
<h2>çº¿ç¨‹æ± <a class="headerlink" href="#id2" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h2>
<figure class="align-center align-default">
<img alt="../../../../../_images/245.jpg" src="../../../../../_images/245.jpg" />
</figure>
<ol class="arabic simple">
<li><p>corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ç›®</p>
<ul class="simple">
<li><p>æœ€å¤šä¿ç•™çš„çº¿ç¨‹æ•°</p></li>
</ul>
</li>
<li><p>maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ç›®</p>
<ul class="simple">
<li><p>æ ¸å¿ƒçº¿ç¨‹ + æ•‘æ€¥çº¿ç¨‹</p></li>
</ul>
</li>
<li><p>keepAliveTime</p>
<ul class="simple">
<li><p>é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹</p></li>
</ul>
</li>
<li><p>unit</p>
<ul class="simple">
<li><p>é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹</p></li>
</ul>
</li>
<li><p>workQueue</p>
<ul class="simple">
<li><p>é˜»å¡é˜Ÿåˆ—</p></li>
</ul>
</li>
<li><p>threadFactory</p>
<ul class="simple">
<li><p>çº¿ç¨‹åˆ›å»ºåç§°</p></li>
</ul>
</li>
<li><p>handler</p>
<ul class="simple">
<li><p>å››ç§</p></li>
</ul>
</li>
</ol>
<section id="threadpoolexecutor">
<h3>ThreadPoolExecutoræ„é€ æ–¹æ³•<a class="headerlink" href="#threadpoolexecutor" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<p>Executorsä¸­åˆ›å»ºçº¿ç¨‹æ± çš„å¿«æ·æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†ThreadPoolExecutorçš„æ„é€ æ–¹æ³•ï¼ˆå®šæ—¶ä»»åŠ¡ä½¿ç”¨çš„æ˜¯ScheduledThreadPoolExecutorï¼‰ï¼Œè¯¥ç±»æ„é€ æ–¹æ³•å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Javaçº¿ç¨‹æ± çš„å®Œæ•´æ„é€ å‡½æ•°</span>
<span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="p">(</span>
   <span class="kt">int</span> <span class="n">corePoolSize</span><span class="p">,</span>    <span class="c1">// çº¿ç¨‹æ± é•¿æœŸç»´æŒçš„çº¿ç¨‹æ•°ï¼Œå³ä½¿çº¿ç¨‹å¤„äºIdleçŠ¶æ€ï¼Œä¹Ÿä¸ä¼šå›æ”¶ã€‚</span>
   <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="p">,</span> <span class="c1">// çº¿ç¨‹æ•°çš„ä¸Šé™</span>
   <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="p">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="p">,</span>  <span class="c1">// è¶…è¿‡corePoolSizeçš„çº¿ç¨‹çš„idleæ—¶é•¿ï¼Œ</span>
                                       <span class="c1">// è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå¤šä½™çš„çº¿ç¨‹ä¼šè¢«å›æ”¶ã€‚</span>
   <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="p">,</span>  <span class="c1">// ä»»åŠ¡çš„æ’é˜Ÿé˜Ÿåˆ—</span>
   <span class="n">ThreadFactory</span> <span class="n">threadFactory</span><span class="p">,</span> <span class="c1">// æ–°çº¿ç¨‹çš„äº§ç”Ÿæ–¹å¼</span>
   <span class="n">RejectedExecutionHandler</span> <span class="n">handler</span><span class="p">)</span>   <span class="c1">// æ‹’ç»ç­–ç•¥</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">æ³¨è§£</p>
<ul class="simple">
<li><p>corePoolSizeå’ŒmaximumPoolSizeè®¾ç½®ä¸å½“ä¼šå½±å“æ•ˆç‡ï¼Œç”šè‡³è€—å°½çº¿ç¨‹ï¼›</p></li>
<li><p>workQueueè®¾ç½®ä¸å½“å®¹æ˜“å¯¼è‡´OOMï¼›</p></li>
<li><p>handlerè®¾ç½®ä¸å½“ä¼šå¯¼è‡´æäº¤ä»»åŠ¡æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</p></li>
</ul>
</div>
</section>
<section id="id3">
<h3>çº¿ç¨‹æ± çš„å·¥ä½œé¡ºåº<a class="headerlink" href="#id3" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<p>corePoolSize -&gt; ä»»åŠ¡é˜Ÿåˆ— -&gt; maximumPoolSize -&gt; æ‹’ç»ç­–ç•¥</p>
<div class="admonition note">
<p class="admonition-title">æ³¨è§£</p>
<p><strong>Runnableå’ŒCallable</strong></p>
<p>å¯ä»¥å‘çº¿ç¨‹æ± æäº¤çš„ä»»åŠ¡æœ‰ä¸¤ç§ï¼šRunnableå’ŒCallableï¼ŒäºŒè€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ol class="arabic simple">
<li><p>æ–¹æ³•ç­¾åä¸åŒï¼Œvoid Runnable.run(),V Callable.call() throws Exception</p></li>
<li><p>æ˜¯å¦å…è®¸æœ‰è¿”å›å€¼ï¼ŒCallableå…è®¸æœ‰è¿”å›å€¼</p></li>
<li><p>æ˜¯å¦å…è®¸æŠ›å‡ºå¼‚å¸¸ï¼ŒCallableå…è®¸æŠ›å‡ºå¼‚å¸¸ã€‚</p></li>
</ol>
<p><strong>Callableæ˜¯JDK1.5æ—¶åŠ å…¥çš„æ¥å£ï¼Œä½œä¸ºRunnableçš„ä¸€ç§è¡¥å……ï¼Œå…è®¸æœ‰è¿”å›å€¼ï¼Œå…è®¸æŠ›å‡ºå¼‚å¸¸ã€‚</strong></p>
</div>
</section>
<section id="id4">
<h3>æäº¤ä»»åŠ¡çš„æ–¹å¼<a class="headerlink" href="#id4" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<p>æ˜¯å¦å…³å¿ƒè¿”å›ç»“æœ?</p>
<ul class="simple">
<li><p>æ˜¯ <code class="docutils literal notranslate"><span class="pre">Future&lt;T&gt;</span> <span class="pre">submit(Callable&lt;T&gt;</span> <span class="pre">task)</span></code></p></li>
<li><p>å¦ <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">execute(Runnable</span> <span class="pre">command)</span></code></p></li>
<li><p>å¦ï¼Œè™½ç„¶è¿”å›Futureï¼Œä½†æ˜¯å…¶get()æ–¹æ³•æ€»æ˜¯è¿”å›null <code class="docutils literal notranslate"><span class="pre">Future&lt;?&gt;</span> <span class="pre">submit(Runnable</span> <span class="pre">task)</span></code></p></li>
</ul>
</section>
<section id="id5">
<h3>å¦‚ä½•æ­£ç¡®ä½¿ç”¨çº¿ç¨‹æ± <a class="headerlink" href="#id5" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<ol class="arabic">
<li><p>é¿å…ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—</p>
<p>ä¸è¦ä½¿ç”¨Executors.newXXXThreadPool()å¿«æ·æ–¹æ³•åˆ›å»ºçº¿ç¨‹æ± ï¼Œå› ä¸ºè¿™ç§æ–¹å¼ä¼šä½¿ç”¨æ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸ºé¿å…OOMï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ThreadPoolExecutorçš„æ„é€ æ–¹æ³•æ‰‹åŠ¨æŒ‡å®šé˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼š</p>
</li>
<li><p>æ˜ç¡®æ‹’ç»ä»»åŠ¡æ—¶çš„è¡Œä¸º</p>
<figure class="align-center align-default">
<img alt="../../../../../_images/333.jpg" src="../../../../../_images/333.jpg" />
</figure>
<ul>
<li><p>AbortPolicy</p>
<blockquote>
<div><p>æŠ›å‡ºRejectedExecutionException</p>
</div></blockquote>
</li>
<li><p>DiscardPolicy</p>
<blockquote>
<div><p>ä»€ä¹ˆä¹Ÿä¸åšï¼Œç›´æ¥å¿½ç•¥</p>
</div></blockquote>
</li>
<li><p>DiscardOldestPolicy</p>
<blockquote>
<div><p>ä¸¢å¼ƒæ‰§è¡Œé˜Ÿåˆ—ä¸­æœ€è€çš„ä»»åŠ¡ï¼Œå°è¯•ä¸ºå½“å‰æäº¤çš„ä»»åŠ¡è…¾å‡ºä½ç½®</p>
</div></blockquote>
</li>
<li><p>CallerRunsPolicy</p>
<blockquote>
<div><p>ç›´æ¥ç”±æäº¤ä»»åŠ¡è€…æ‰§è¡Œè¿™ä¸ªä»»åŠ¡</p>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">æ³¨è§£</p>
<p>çº¿ç¨‹æ± é»˜è®¤çš„æ‹’ç»è¡Œä¸ºæ˜¯AbortPolicyï¼Œä¹Ÿå°±æ˜¯æŠ›å‡ºRejectedExecutionHandlerå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸æ˜¯éå—æ£€å¼‚å¸¸ï¼Œå¾ˆå®¹æ˜“å¿˜è®°æ•è·ã€‚</p>
<p>å¦‚æœä¸å…³å¿ƒä»»åŠ¡è¢«æ‹’ç»çš„äº‹ä»¶ï¼Œå¯ä»¥å°†æ‹’ç»ç­–ç•¥è®¾ç½®æˆDiscardPolicyï¼Œè¿™æ ·å¤šä½™çš„ä»»åŠ¡ä¼šè¢«å¿½ç•¥ã€‚</p>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">,</span>
            <span class="k">new</span> <span class="n">ArrayBlockingQueue</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span>
            <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">DiscardPolicy</span><span class="p">());</span><span class="c1">// æŒ‡å®šæ‹’ç»ç­–ç•¥</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id6">
<h3>è·å–å¤„ç†ç»“æœå’Œå¼‚å¸¸<a class="headerlink" href="#id6" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<p>çº¿ç¨‹æ± çš„å¤„ç†ç»“æœã€ä»¥åŠå¤„ç†è¿‡ç¨‹ä¸­çš„å¼‚å¸¸éƒ½è¢«åŒ…è£…åˆ°Futureä¸­ï¼Œå¹¶åœ¨è°ƒç”¨Future.get()æ–¹æ³•æ—¶è·å–ã€‚</p>
<p>æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸ä¼šè¢«åŒ…è£…æˆExecutionExceptionï¼Œsubmit()æ–¹æ³•æœ¬èº«ä¸ä¼šä¼ é€’ç»“æœå’Œä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸ã€‚</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">executorService</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Object</span> <span class="nf">call</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;exception in call~&quot;</span><span class="p">);</span><span class="c1">// è¯¥å¼‚å¸¸ä¼šåœ¨è°ƒç”¨Future.get()æ—¶ä¼ é€’ç»™è°ƒç”¨è€…</span>
        <span class="p">}</span>
    <span class="p">});</span>

<span class="k">try</span> <span class="p">{</span>
   <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// interrupt</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// exception in Callable.call()</span>
   <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<figure class="align-center align-default">
<img alt="../../../../../_images/427.jpg" src="../../../../../_images/427.jpg" />
</figure>
</section>
</section>
<section id="id7">
<h2>çº¿ç¨‹æ± çš„å¸¸ç”¨åœºæ™¯<a class="headerlink" href="#id7" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h2>
<section id="id8">
<h3>æ­£ç¡®æ„é€ çº¿ç¨‹æ± <a class="headerlink" href="#id8" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">poolSize</span> <span class="o">=</span> <span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">().</span><span class="na">availableProcessors</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>

<span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayBlockingQueue</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">512</span><span class="p">);</span>

<span class="n">RejectedExecutionHandler</span> <span class="n">policy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">DiscardPolicy</span><span class="p">();</span>

<span class="n">executorService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">poolSize</span><span class="p">,</span> <span class="n">poolSize</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">,</span>
            <span class="n">queue</span><span class="p">,</span>
            <span class="n">policy</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id9">
<h3>è·å–å•ä¸ªç»“æœ<a class="headerlink" href="#id9" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<p>é€šè¿‡submit()å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡åä¼šè¿”å›ä¸€ä¸ªFutureï¼Œè°ƒç”¨ <code class="docutils literal notranslate"><span class="pre">V</span> <span class="pre">Future.get()</span></code> æ–¹æ³•èƒ½å¤Ÿé˜»å¡ç­‰å¾…æ‰§è¡Œç»“æœï¼Œ<code class="docutils literal notranslate"><span class="pre">V</span> <span class="pre">get(long</span> <span class="pre">timeout,</span> <span class="pre">TimeUnit</span> <span class="pre">unit)</span></code> æ–¹æ³•å¯ä»¥æŒ‡å®šç­‰å¾…çš„è¶…æ—¶æ—¶é—´ã€‚</p>
</section>
<section id="id10">
<h3>è·å–å¤šä¸ªç»“æœ<a class="headerlink" href="#id10" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<p>å¦‚æœå‘çº¿ç¨‹æ± æäº¤äº†å¤šä¸ªä»»åŠ¡ï¼Œè¦è·å–è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œå¯ä»¥ä¾æ¬¡è°ƒç”¨ <code class="docutils literal notranslate"><span class="pre">Future.get()</span></code> è·å¾—ã€‚</p>
<p>ä½†å¯¹äºè¿™ç§åœºæ™¯ï¼Œæˆ‘ä»¬æ›´åº”è¯¥ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">ExecutorCompletionService</span></code> ï¼Œè¯¥ç±»çš„take()æ–¹æ³•æ€»æ˜¯é˜»å¡ç­‰å¾…æŸä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œç„¶åè¿”å›è¯¥ä»»åŠ¡çš„Futureå¯¹è±¡ã€‚å‘CompletionServiceæ‰¹é‡æäº¤ä»»åŠ¡åï¼Œåªéœ€è°ƒç”¨ç›¸åŒæ¬¡æ•°çš„CompletionService.take()æ–¹æ³•ï¼Œå°±èƒ½è·å–æ‰€æœ‰ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œè·å–é¡ºåºæ˜¯ä»»æ„çš„ï¼Œå–å†³äºä»»åŠ¡çš„å®Œæˆé¡ºåºï¼š</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">solve</span><span class="p">(</span><span class="n">Executor</span> <span class="n">executor</span><span class="p">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">Result</span><span class="o">&gt;&gt;</span> <span class="n">solvers</span><span class="p">)</span>
   <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="p">,</span> <span class="n">ExecutionException</span> <span class="p">{</span>

   <span class="n">CompletionService</span><span class="o">&lt;</span><span class="n">Result</span><span class="o">&gt;</span> <span class="n">ecs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExecutorCompletionService</span><span class="o">&lt;</span><span class="n">Result</span><span class="o">&gt;</span><span class="p">(</span><span class="n">executor</span><span class="p">);</span><span class="c1">// æ„é€ å™¨</span>

   <span class="k">for</span> <span class="p">(</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">Result</span><span class="o">&gt;</span> <span class="n">s</span> <span class="p">:</span> <span class="n">solvers</span><span class="p">)</span><span class="c1">// æäº¤æ‰€æœ‰ä»»åŠ¡</span>
       <span class="n">ecs</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>

   <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">solvers</span><span class="p">.</span><span class="na">size</span><span class="p">();</span>
   <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span><span class="c1">// è·å–æ¯ä¸€ä¸ªå®Œæˆçš„ä»»åŠ¡</span>
       <span class="n">Result</span> <span class="n">r</span> <span class="o">=</span> <span class="n">ecs</span><span class="p">.</span><span class="na">take</span><span class="p">().</span><span class="na">get</span><span class="p">();</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
           <span class="n">use</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3>å•ä¸ªä»»åŠ¡çš„è¶…æ—¶æ—¶é—´<a class="headerlink" href="#id11" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">V</span> <span class="pre">Future.get(long</span> <span class="pre">timeout,</span> <span class="pre">TimeUnit</span> <span class="pre">unit)</span></code> æ–¹æ³•å¯ä»¥æŒ‡å®šç­‰å¾…çš„è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶æœªå®Œæˆä¼šæŠ›å‡º <code class="docutils literal notranslate"><span class="pre">TimeoutException</span></code>ã€‚</p>
</section>
<section id="id12">
<h3>æ€»ç»“<a class="headerlink" href="#id12" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">ïƒ</a></h3>
<p>Executorsä¸ºæˆ‘ä»¬æä¾›äº†æ„é€ çº¿ç¨‹æ± çš„ä¾¿æ·æ–¹æ³•ï¼Œå¯¹äºæœåŠ¡å™¨ç¨‹åºæˆ‘ä»¬åº”è¯¥æœç»ä½¿ç”¨è¿™äº›ä¾¿æ·æ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨çº¿ç¨‹æ± ThreadPoolExecutorçš„æ„é€ æ–¹æ³•ï¼Œé¿å…æ— ç•Œé˜Ÿåˆ—å¯èƒ½å¯¼è‡´çš„OOMä»¥åŠçº¿ç¨‹ä¸ªæ•°é™åˆ¶ä¸å½“å¯¼è‡´çš„çº¿ç¨‹æ•°è€—å°½ç­‰é—®é¢˜ã€‚</p>
<p>ExecutorCompletionServiceæä¾›äº†ç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œç»“æŸçš„æœ‰æ•ˆæ–¹å¼ï¼Œå¦‚æœè¦è®¾ç½®ç­‰å¾…çš„è¶…æ—¶æ—¶é—´ï¼Œåˆ™å¯ä»¥é€šè¿‡CountDownLatchå®Œæˆã€‚</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../collection/hashmap/hashmap.html" class="btn btn-neutral float-left" title="HashMap" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> ä¸Šä¸€é¡µ</a>
        <a href="sleepvswait.html" class="btn btn-neutral float-right" title="Sleep å’Œ Wait çš„åŒºåˆ«" accesskey="n" rel="next">ä¸‹ä¸€é¡µ <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; ç‰ˆæƒæ‰€æœ‰ 2021, linzzz.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>