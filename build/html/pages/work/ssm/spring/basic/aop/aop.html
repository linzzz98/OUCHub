

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>8. AOP &mdash; OUCHub  文档</title>
  

  
  <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/twemoji.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/language_data.js"></script>
        <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"></script>
        <script src="../../../../../../_static/twemoji.js"></script>
        <script src="../../../../../../_static/translations.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../../../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../../../../search.html" />
    <link rel="next" title="9. AOP知识点" href="aop_knowledge.html" />
    <link rel="prev" title="7. 注解知识点" href="../annotation/anno_knowledge.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> OUCHub
          

          
            
            <img src="../../../../../../_static/logo_1.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">基础知识</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../knowledge/k_MH.html">💊 Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../knowledge/k_CV.html">🍤 Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../knowledge/k_ML.html">🍎 Machine Learning</a></li>
</ul>
<p class="caption"><span class="caption-text">论文学习</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../paper/p_sfm.html">🍊 Structure from Motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../paper/p_slam.html">🍊 SLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../paper/p_pointcloud.html">🍋 Point Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../paper/p_BA.html">🍊 Bundle Adjustment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../paper/p_others.html">🍒 Others</a></li>
</ul>
<p class="caption"><span class="caption-text">源码解析</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../code/colmap.html">🍑 Colmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../code/theiasfm.html">🍑 TheiaSfM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../code/ba.html">🍑 Bundle Adjustment</a></li>
</ul>
<p class="caption"><span class="caption-text">算法学习</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../algorithm/algorithm.html">🍑 Algorithm</a></li>
</ul>
<p class="caption"><span class="caption-text">工作知识</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../work.html">🍑 Work</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../mysql/mysql.html">🍑 Algorithm</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../ssm.html">SSM</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../frame/frame.html">1. Spring系统架构和核心概念</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ioc/ioc.html">2. Ioc基础入门</a></li>
<li class="toctree-l3"><a class="reference internal" href="../di/di.html">3. DI基础入门</a></li>
<li class="toctree-l3"><a class="reference internal" href="../prop/prop.html">4. Properties文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../container/container.html">5. 容器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../annotation/annotation.html">6. IOC/DI注解开发</a></li>
<li class="toctree-l3"><a class="reference internal" href="../annotation/anno_knowledge.html">7. 注解知识点</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">8. AOP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">核心概念</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">AOP入门</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">AOP工作流程</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">AOP配置管理</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id5">语法格式</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id6">通配符</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id7">书写技巧</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id8">AOP通知类型</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id9">AOP通知获取数据</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id10">总结</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id11">AOP的核心概念</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id12">切入点表达式</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id13">五种通知类型</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id14">通知中获取参数</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="aop_knowledge.html">9. AOP知识点</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">杂七杂八</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../others/o_others.html">🍺 Others</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">OUCHub</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../work.html">🍑 Work</a> &raquo;</li>
        
          <li><a href="../../../ssm.html">SSM</a> &raquo;</li>
        
      <li><span class="section-number">8. </span>AOP</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../../_sources/pages/work/ssm/spring/basic/aop/aop.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="aop">
<h1><span class="section-number">8. </span>AOP<a class="headerlink" href="#aop" title="永久链接至标题">¶</a></h1>
<div class="section" id="id1">
<h2>核心概念<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>AOP(Aspect Oriented Programming)面向切面编程，一种编程范式，指导开发者如何组织程序结构，AOP在不改原有代码的前提下对其进行增强</p>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/162.jpg" src="../../../../../../_images/162.jpg" />
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<ul>
<li><p>连接点(JoinPoint)：程序执行过程中的任意位置，粒度为执行方法、抛出异常、设置变量等</p>
<blockquote>
<div><ul class="simple">
<li><p>在SpringAOP中，理解为方法的执行</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<ul>
<li><p>切入点(Pointcut)：匹配连接点的式子</p>
<blockquote>
<div><ul>
<li><p>在SpringAOP中，一个切入点可以描述一个具体方法，也可也匹配多个方法</p>
<blockquote>
<div><ul class="simple">
<li><p>具体的方法：如com.linzz.dao包下的BookDao接口中的无形参无返回值的save方法</p></li>
<li><p>匹配多个方法：所有的save方法，所有的get开头的方法，所有以Dao结尾的接口中的任意方法，所有带有一个参数的方法</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<ul class="simple">
<li><p>连接点范围要比切入点范围大，是切入点的方法也一定是连接点，但是是连接点的方法就不一定要被增强，所以可能不是切入点。</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<ul>
<li><p>通知(Advice)：在切入点处执行的操作，也就是共性功能</p>
<blockquote>
<div><ul class="simple">
<li><p>在SpringAOP中，功能最终以方法的形式呈现</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<ul class="simple">
<li><p>通知类：定义通知的类</p></li>
</ul>
<ul class="simple">
<li><p>切面(Aspect)：描述通知与切入点的对应关系。</p></li>
</ul>
</div>
</div>
<div class="section" id="id2">
<h2>AOP入门<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<ol class="arabic">
<li><p><strong>添加依赖</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>aspectjweaver<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.9.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>因为 <code class="docutils literal notranslate"><span class="pre">spring-context</span></code> 中已经导入了 <code class="docutils literal notranslate"><span class="pre">spring-aop</span></code> ,所以不需要再单独导入 <code class="docutils literal notranslate"><span class="pre">spring-aop</span></code></p></li>
<li><p>导入AspectJ的jar包，AspectJ是AOP思想的一个具体实现，Spring有自己的AOP实现，但是相比于AspectJ来说比较麻烦，所以直接采用Spring整合ApsectJ的方式进行AOP开发。</p></li>
</ul>
</li>
<li><p><strong>定义接口与实现类</strong></p></li>
<li><p><strong>定义通知类和通知</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAdvice</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="p">(){</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>定义切入点</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAdvice</span> <span class="p">{</span>
    <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&quot;execution(void com.linzzz.dao.BookDao.update())&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">pt</span><span class="p">(){}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="p">(){</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>制作切面</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAdvice</span> <span class="p">{</span>
    <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&quot;execution(void com.linzzz.dao.BookDao.update())&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">pt</span><span class="p">(){}</span>

    <span class="nd">@Before</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="p">(){</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>绑定切入点与通知关系，并指定通知添加到原始连接点的具体执行 <strong>位置</strong></p>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/241.jpg" src="../../../../../../_images/241.jpg" />
</div>
</li>
<li><p><strong>将通知类配给容器并标识其为切面类</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAdvice</span> <span class="p">{</span>
    <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&quot;execution(void com.linzzz.dao.BookDao.update())&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">pt</span><span class="p">(){}</span>

    <span class="nd">@Before</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="p">(){</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>开启注解格式AOP功能</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="p">(</span><span class="s">&quot;com.linzzz&quot;</span><span class="p">)</span>
<span class="nd">@EnableAspectJAutoProxy</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id3">
<h2>AOP工作流程<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>AOP是基于Spring容器管理的bean做的增强，所以整个工作过程需要从Spring加载bean开始</p>
<ol class="arabic">
<li><p><strong>Spring容器启动</strong></p>
<p>此时，需要加载的类有：（1） 被增强类，如:BookServiceImpl、 （2） 通知类，如:MyAdvice， bean对象此时还没有创建成功</p>
</li>
<li><p><strong>读取所有切面配置中的切入点</strong></p>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/329.jpg" src="../../../../../../_images/329.jpg" />
</div>
</li>
<li><p><strong>初始化bean</strong></p>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/423.jpg" src="../../../../../../_images/423.jpg" />
</div>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>匹配失败，创建原始对象，说明不需要增强，直接调用原始对象的方法即可。</p>
<p>匹配成功，创建原始对象（ <strong>目标对象</strong> ）的 <strong>代理</strong> 对象</p>
</div>
</li>
<li><p><strong>获取bean执行方法</strong></p>
<ul class="simple">
<li><p>获取的bean是原始对象时，调用方法并执行，完成操作</p></li>
</ul>
<ul class="simple">
<li><p>获取的bean是代理对象时，根据代理对象的运行模式运行原始方法与增强的内容，完成操作</p></li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">注解</p>
<ul class="simple">
<li><p>如果目标对象中的方法会被增强，那么容器中将存入的是目标对象的代理对象</p></li>
<li><p>如果目标对象中的方法不被增强，那么容器中将存入的是目标对象本身。</p></li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h2>AOP配置管理<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/519.jpg" src="../../../../../../_images/519.jpg" />
</div>
<div class="section" id="id5">
<h3>语法格式<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>切入点:要进行增强的方法</p></li>
<li><p>切入点表达式:要进行增强的方法的描述方式</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>切入点表达式的语法为:</p>
<p>切入点表达式标准格式：动作关键字(访问修饰符  返回值  包名.类/接口名.方法名(参数) 异常名）</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">execution</span><span class="p">(</span><span class="kd">public</span> <span class="n">User</span> <span class="n">com</span><span class="p">.</span><span class="na">linzzz</span><span class="p">.</span><span class="na">service</span><span class="p">.</span><span class="na">UserService</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="kt">int</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><p>execution：动作关键字，描述切入点的行为动作，例如execution表示执行到指定切入点</p></li>
<li><p>public：访问修饰符,还可以是public，private等，可以省略</p></li>
<li><p>User：返回值，写返回值类型</p></li>
<li><p>com.linzzz.service：包名，多级包使用点连接</p></li>
<li><p>UserService：类/接口名称</p></li>
<li><p>findById：方法名</p></li>
<li><p>int：参数，直接写参数的类型，多个类型用逗号隔开</p></li>
<li><p>异常名：方法定义中抛出指定异常，可以省略</p></li>
</ul>
</div>
</div>
<div class="section" id="id6">
<h3>通配符<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">\*</span></code>：单个独立的任意符号，可以独立出现，也可以作为前缀或者后缀的匹配符出现</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">execution</span><span class="p">(</span><span class="kd">public</span> <span class="o">*</span> <span class="n">com</span><span class="p">.</span><span class="na">linzzz</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="na">UserService</span><span class="p">.</span><span class="na">find</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">))</span>
</pre></div>
</div>
<p>匹配com.linzzz包下的任意包中的UserService类或接口中所有find开头的带有一个参数的方法</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">..</span></code>：多个连续的任意符号，可以独立出现，常用于简化包名与参数的书写</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">execution</span><span class="p">(</span><span class="kd">public</span> <span class="n">User</span> <span class="n">com</span><span class="p">..</span><span class="na">UserService</span><span class="p">.</span><span class="na">findById</span><span class="p">(..))</span>
</pre></div>
</div>
<p>匹配com包下的任意包中的UserService类或接口中所有名称为findById的方法</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code>：专用于匹配子类类型</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">execution</span><span class="p">(</span><span class="o">*</span> <span class="o">*</span><span class="p">..</span><span class="o">*</span><span class="n">Service</span><span class="o">+</span><span class="p">.</span><span class="o">*</span><span class="p">(..))</span>
</pre></div>
</div>
<p>*Service+ 表示所有以Service结尾的接口的子类。</p>
</li>
<li><p>e.g.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// 匹配接口，能匹配到</span>
<span class="n">execution</span><span class="p">(</span><span class="kt">void</span> <span class="n">com</span><span class="p">.</span><span class="na">linzzz</span><span class="p">.</span><span class="na">dao</span><span class="p">.</span><span class="na">BookDao</span><span class="p">.</span><span class="na">update</span><span class="p">())</span>

<span class="c1">// 匹配实现类，能匹配到</span>
<span class="n">execution</span><span class="p">(</span><span class="kt">void</span> <span class="n">com</span><span class="p">.</span><span class="na">linzzz</span><span class="p">.</span><span class="na">dao</span><span class="p">.</span><span class="na">impl</span><span class="p">.</span><span class="na">BookDaoImpl</span><span class="p">.</span><span class="na">update</span><span class="p">())</span>

<span class="c1">// 返回值任意，能匹配到</span>
<span class="n">execution</span><span class="p">(</span><span class="o">*</span> <span class="n">com</span><span class="p">.</span><span class="na">linzzz</span><span class="p">.</span><span class="na">dao</span><span class="p">.</span><span class="na">impl</span><span class="p">.</span><span class="na">BookDaoImpl</span><span class="p">.</span><span class="na">update</span><span class="p">())</span>

<span class="c1">// 返回值任意，但是update方法必须要有一个参数，无法匹配，要想匹配需要在update接口和实现类添加参数</span>
<span class="n">execution</span><span class="p">(</span><span class="o">*</span> <span class="n">com</span><span class="p">.</span><span class="na">linzzz</span><span class="p">.</span><span class="na">dao</span><span class="p">.</span><span class="na">impl</span><span class="p">.</span><span class="na">BookDaoImpl</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="o">*</span><span class="p">))</span>

<span class="c1">// 返回值为void,com包下的任意包三层包下的任意类的update方法，匹配到的是实现类，能匹配</span>
<span class="n">execution</span><span class="p">(</span><span class="kt">void</span> <span class="n">com</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="na">update</span><span class="p">())</span>

<span class="c1">// 返回值为void,com包下的任意两层包下的任意类的update方法，匹配到的是接口，能匹配</span>
<span class="n">execution</span><span class="p">(</span><span class="kt">void</span> <span class="n">com</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="na">update</span><span class="p">())</span>

<span class="c1">// 返回值为void，方法名是update的任意包下的任意类，能匹配</span>
<span class="n">execution</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">..</span><span class="na">update</span><span class="p">())</span>

<span class="c1">// 匹配项目中任意类的任意方法，能匹配，但是不建议使用这种方式，影响范围广</span>
<span class="n">execution</span><span class="p">(</span><span class="o">*</span> <span class="o">*</span><span class="p">..</span><span class="o">*</span><span class="p">(..))</span>

<span class="c1">// 匹配项目中任意包任意类下只要以u开头的方法，update方法能满足，能匹配</span>
<span class="n">execution</span><span class="p">(</span><span class="o">*</span> <span class="o">*</span><span class="p">..</span><span class="na">u</span><span class="o">*</span><span class="p">(..))</span>

<span class="c1">// 匹配项目中任意包任意类下只要以e结尾的方法，update和save方法能满足，能匹配</span>
<span class="n">execution</span><span class="p">(</span><span class="o">*</span> <span class="o">*</span><span class="p">..</span><span class="o">*</span><span class="n">e</span><span class="p">(..))</span>

<span class="c1">// 返回值为void，com包下的任意包任意类任意方法，能匹配，*代表的是方法</span>
<span class="n">execution</span><span class="p">(</span><span class="kt">void</span> <span class="n">com</span><span class="p">..</span><span class="o">*</span><span class="p">())</span>

<span class="c1">// 将项目中所有业务层方法的以find开头的方法匹配</span>
<span class="n">execution</span><span class="p">(</span><span class="o">*</span> <span class="n">com</span><span class="p">.</span><span class="na">linzzz</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="n">Service</span><span class="p">.</span><span class="na">find</span><span class="o">*</span><span class="p">(..))</span>

<span class="c1">// 将项目中所有业务层方法的以save开头的方法匹配</span>
<span class="n">execution</span><span class="p">(</span><span class="o">*</span> <span class="n">com</span><span class="p">.</span><span class="na">linzzz</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="n">Service</span><span class="p">.</span><span class="na">save</span><span class="o">*</span><span class="p">(..))</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id7">
<h3>书写技巧<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<ol class="arabic simple">
<li><p>所有代码按照标准规范开发，否则以下技巧全部失效</p></li>
</ol>
<ol class="arabic simple" start="2">
<li><p>描述切入点通常 <strong>描述接口</strong> ，而不描述实现类,如果描述到实现类，就会出现紧耦合</p></li>
</ol>
<ol class="arabic simple" start="3">
<li><p>访问控制修饰符针对接口开发均采用public描述（<strong>可省略访问控制修饰符描述</strong>）</p></li>
</ol>
<ol class="arabic simple" start="4">
<li><p>返回值类型对于增删改类使用精准类型加速匹配，对于查询类使用 <code class="docutils literal notranslate"><span class="pre">\*</span></code> 通配快速描述</p></li>
</ol>
<ol class="arabic simple" start="5">
<li><p><strong>包名</strong> 书写 <strong>尽量不使用..匹配</strong>，效率过低，常用 <code class="docutils literal notranslate"><span class="pre">\*</span></code> 做单个包描述匹配，或精准匹配</p></li>
</ol>
<ol class="arabic simple" start="6">
<li><p><strong>接口名/类名</strong> 书写名称与模块相关的采用 <code class="docutils literal notranslate"><span class="pre">\*</span></code> 匹配，例如 UserService 书写成 *Service，绑定业务层接口名</p></li>
</ol>
<ol class="arabic simple" start="7">
<li><p><strong>方法名</strong> 书写以 <strong>动词</strong> 进行 <strong>精准匹配</strong>，名词采用 <code class="docutils literal notranslate"><span class="pre">\*</span></code> 匹配，例如getById书写成getBy*, selectAll书写成selectAll</p></li>
</ol>
<ol class="arabic simple" start="8">
<li><p>通常 <strong>不使用异常</strong> 作为匹配规则</p></li>
</ol>
</div>
</div>
<div class="section" id="id8">
<h2>AOP通知类型<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<p>AOP共提供了5种通知类型:</p>
<ul class="simple">
<li><p>前置通知</p></li>
<li><p>后置通知</p></li>
<li><p><strong>环绕通知(重点)</strong></p></li>
<li><p>返回后通知(了解)</p></li>
<li><p>抛出异常后通知(了解)</p></li>
</ul>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/614.jpg" src="../../../../../../_images/614.jpg" />
</div>
<p>(1). <strong>前置通知：</strong> 追加功能到方法执行前,类似于在代码1或者代码2添加内容</p>
<p>(2). <strong>后置通知：</strong> 追加功能到方法执行后,不管方法执行的过程中有没有抛出异常都会执行，类似于在代码5添加内容</p>
<p>(3). <strong>返回后通知：</strong> 追加功能到方法执行后，只有方法正常执行结束后才进行,类似于在代码3添加内容，如果方法执行抛出异常，返回后通知将不会被添加</p>
<p>(4). <strong>抛出异常后通知：</strong> 追加功能到方法抛出异常后，只有方法执行出异常才进行,类似于在代码4添加内容，只有方法抛出异常后才会被添加</p>
<p>(5). <strong>环绕通知：</strong> 环绕通知功能比较强大，它可以追加功能到方法执行的前后，这也是比较常用的方式，它可以实现其他四种通知类型的功能</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAdvice</span> <span class="p">{</span>
    <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&quot;execution(void com.linzzz.dao.BookDao.update())&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">pt</span><span class="p">(){}</span>

    <span class="nd">@Before</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
    <span class="c1">//此处也可以写成 @Before(&quot;MyAdvice.pt()&quot;),不建议</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;before advice ...&quot;</span><span class="p">);</span>
    <span class="p">}</span>

   <span class="nd">@After</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">after</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;after advice ...&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Around</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Throwable</span><span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;around before advice ...&quot;</span><span class="p">);</span>
        <span class="c1">//表示对原始操作的调用</span>
        <span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;around after advice ...&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@AfterReturning</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterReturning</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afterReturning advice ...&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@AfterReturning</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterThrowing</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afterThrowing advice ...&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<ol class="arabic">
<li><p>原始方法有返回值的处理</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Around</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">Object</span> <span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="p">{</span>
   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;around before advice ...&quot;</span><span class="p">);</span>
   <span class="c1">//表示对原始操作的调用</span>
   <span class="n">Object</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span>
   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;around after advice ...&quot;</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>为什么返回的是Object而不是int的主要原因是Object类型更通用。</p></li>
<li><p>在环绕通知中是可以对原始方法返回值就行修改的。</p></li>
</ul>
</li>
<li><p>环绕通知必须依赖形参ProceedingJoinPoint才能实现对原始方法的调用，进而实现原始方法调用前后同时添加通知</p></li>
<li><p>通知中如果未使用ProceedingJoinPoint对原始方法进行调用将跳过原始方法的执行</p></li>
<li><p>对原始方法的调用可以不接收返回值，通知方法设置成void即可，如果接收返回值，最好设定为Object类型</p></li>
<li><p>原始方法的返回值如果是void类型，通知方法的返回值类型可以设置成void,也可以设置成Object</p></li>
<li><p>由于无法预知原始方法运行后是否会抛出异常，因此环绕通知方法必须要处理Throwable异常</p></li>
<li><p>如何区分到底是哪个接口的哪个方法执行的</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Around</span><span class="p">(</span><span class="s">&quot;Pt()&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="p">){</span>
   <span class="c1">//获取执行签名信息</span>
   <span class="n">Signature</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">getSignature</span><span class="p">();</span>
   <span class="c1">//通过签名获取执行操作名称(接口名)</span>
   <span class="n">String</span> <span class="n">className</span> <span class="o">=</span> <span class="n">signature</span><span class="p">.</span><span class="na">getDeclaringTypeName</span><span class="p">();</span>
   <span class="c1">//通过签名获取执行操作名称(方法名)</span>
   <span class="n">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">signature</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span>

   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;执行：&quot;</span><span class="o">+</span> <span class="n">className</span><span class="o">+</span><span class="s">&quot;.&quot;</span><span class="o">+</span><span class="n">methodName</span><span class="o">+</span><span class="s">&quot;----&gt;&quot;</span> <span class="o">+</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;ms&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id9">
<h3>AOP通知获取数据<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>获取切入点方法的参数，所有的通知类型都可以获取参数</p>
<ul class="simple">
<li><p>JoinPoint：适用于前置、后置、返回后、抛出异常后通知</p></li>
</ul>
<ul class="simple">
<li><p>ProceedingJoinPoint：适用于环绕通知</p></li>
</ul>
<ol class="arabic">
<li><p><strong>获取参数</strong></p>
<ul>
<li><p>非环绕通知获取方式（在方法上添加JoinPoint,通过JoinPoint来获取参数）</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAdvice</span> <span class="p">{</span>
    <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&quot;execution(* com.linzzz.dao.BookDao.findName(..))&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">pt</span><span class="p">(){}</span>

    <span class="nd">@Before</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="p">(</span><span class="n">JoinPoint</span> <span class="n">jp</span><span class="p">)</span>
        <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="n">jp</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">args</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;before advice ...&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p><strong>思考:方法的参数只有一个，为什么获取的是一个数组?</strong></p>
<p>因为参数的个数是不固定的，所以使用数组更通配些。</p>
<p><strong>说明:</strong></p>
<p>使用JoinPoint的方式获取参数适用于 <code class="docutils literal notranslate"><span class="pre">前置</span></code> 、 <code class="docutils literal notranslate"><span class="pre">后置</span></code> 、 <code class="docutils literal notranslate"><span class="pre">返回后</span></code> 、 <code class="docutils literal notranslate"><span class="pre">抛出异常后</span></code> 通知。</p>
</div>
</div></blockquote>
</li>
<li><p>环绕通知获取方式（在方法上添加ProceedingJoinPoint）</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAdvice</span> <span class="p">{</span>
    <span class="nd">@Pointcut</span><span class="p">(</span><span class="s">&quot;execution(* com.itheima.dao.BookDao.findName(..))&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">pt</span><span class="p">(){}</span>

    <span class="nd">@Around</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="p">)</span><span class="kd">throws</span> <span class="n">Throwable</span> <span class="p">{</span>
        <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">args</span><span class="p">));</span>
        <span class="n">Object</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>pjp.proceed()方法是有两个构造方法，分别是:</p>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/79.jpg" src="../../../../../../_images/79.jpg" />
</div>
<ul class="simple">
<li><p>调用无参数的proceed，当原始方法有参数，会在调用的过程中自动传入参数</p></li>
<li><p>当需要修改原始方法的参数时，就只能采用带有参数的方法</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Around</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">Object</span> <span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Throwable</span><span class="p">{</span>
   <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span>
   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">args</span><span class="p">));</span>
   <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="mi">666</span><span class="p">;</span>
   <span class="n">Object</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div></blockquote>
</li>
</ul>
</li>
<li><p><strong>获取返回值</strong></p>
<p>对于返回值，只有返回后 <code class="docutils literal notranslate"><span class="pre">AfterReturing</span></code> 和环绕 <code class="docutils literal notranslate"><span class="pre">Around</span></code> 这两个通知类型可以获取</p>
<ul>
<li><p>环绕通知获取返回值</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Around</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">Object</span> <span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Throwable</span><span class="p">{</span>
   <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span>
   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">args</span><span class="p">));</span>
   <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="mi">666</span><span class="p">;</span>
   <span class="n">Object</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ret</span></code> 就是方法的返回值，可以直接获取，也可以进行修改。</p>
</div></blockquote>
</li>
<li><p>返回后通知获取返回值</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@AfterReturning</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;pt()&quot;</span><span class="p">,</span><span class="n">returning</span> <span class="o">=</span> <span class="s">&quot;ret&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterReturning</span><span class="p">(</span><span class="n">Object</span> <span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afterReturning advice ...&quot;</span><span class="o">+</span><span class="n">ret</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<p>(1). <strong>参数名的问题</strong></p>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/88.jpg" src="../../../../../../_images/88.jpg" />
</div>
<p>(2). <strong>afterReturning方法参数类型的问题</strong></p>
<blockquote>
<div><p>参数类型可以写成String，但是为了能匹配更多的参数类型，建议写成Object类型</p>
</div></blockquote>
<p>(3). <strong>afterReturning方法参数的顺序问题</strong></p>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/96.jpg" src="../../../../../../_images/96.jpg" />
</div>
</div>
</li>
<li><p><strong>获取异常</strong></p>
<p>对于获取抛出的异常，只有抛出异常后 <code class="docutils literal notranslate"><span class="pre">AfterThrowing</span></code> 和环绕 <code class="docutils literal notranslate"><span class="pre">Around</span></code> 这两个通知类型可以获取</p>
<ul>
<li><p>环绕通知获取异常</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Around</span><span class="p">(</span><span class="s">&quot;pt()&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">Object</span> <span class="nf">around</span><span class="p">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="p">){</span>
   <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">getArgs</span><span class="p">();</span>
   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">args</span><span class="p">));</span>
   <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="mi">666</span><span class="p">;</span>
   <span class="n">Object</span> <span class="n">ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
   <span class="k">try</span><span class="p">{</span>
      <span class="n">ret</span> <span class="o">=</span> <span class="n">pjp</span><span class="p">.</span><span class="na">proceed</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
   <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">Throwable</span> <span class="n">throwable</span><span class="p">){</span>
      <span class="n">t</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>抛出异常后通知获取异常</p>
<blockquote>
<div><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@AfterThrowing</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;pt()&quot;</span><span class="p">,</span><span class="n">throwing</span> <span class="o">=</span> <span class="s">&quot;t&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterThrowing</span><span class="p">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afterThrowing advice ...&quot;</span><span class="o">+</span><span class="n">t</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<div class="admonition attention">
<p class="admonition-title">注意</p>
<div class="align-center figure align-default">
<img alt="../../../../../../_images/104.jpg" src="../../../../../../_images/104.jpg" />
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="id10">
<h2>总结<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h2>
<div class="section" id="id11">
<h3>AOP的核心概念<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>概念：AOP(Aspect Oriented Programming)面向切面编程，一种编程范式</p></li>
<li><p>作用：在不惊动原始设计的基础上为方法进行功能 <strong>增强</strong></p></li>
<li><p>核心概念</p>
<ul>
<li><p>代理（Proxy）：SpringAOP的核心本质是采用代理模式实现的</p></li>
<li><p>连接点（JoinPoint）：在SpringAOP中，理解为任意方法的执行</p></li>
<li><p>切入点（Pointcut）：匹配连接点的式子，也是具有共性功能的方法描述</p></li>
<li><p>通知（Advice）：若干个方法的共性功能，在切入点处执行，最终体现为一个方法</p></li>
<li><p>切面（Aspect）：描述通知与切入点的对应关系</p></li>
<li><p>目标对象（Target）：被代理的原始对象成为目标对象</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id12">
<h3>切入点表达式<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<p>切入点表达式标准格式：动作关键字(访问修饰符  返回值  包名.类/接口名.方法名（参数）异常名)</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">execution</span><span class="p">(</span><span class="o">*</span> <span class="n">com</span><span class="p">.</span><span class="na">linzzz</span><span class="p">.</span><span class="na">service</span><span class="p">.</span><span class="o">*</span><span class="n">Service</span><span class="p">.</span><span class="o">*</span><span class="p">(..))</span>
</pre></div>
</div>
<p>切入点表达式描述通配符：</p>
<ul class="simple">
<li><p>作用：用于快速描述，范围描述</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\*</span></code> ：匹配任意符号（常用）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">..</span></code> ：匹配多个连续的任意符号（常用）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\+</span></code> ：匹配子类类型</p></li>
</ul>
<p>切入点表达式书写技巧</p>
<ul class="simple">
<li><p>按 <strong>标准规范</strong> 开发</p></li>
<li><p>查询操作的返回值建议使用*匹配</p></li>
<li><p>减少使用..的形式描述包</p></li>
<li><p><strong>对接口进行描述</strong>，使用 * 表示模块名，例如UserService的匹配描述为*Service</p></li>
<li><p>方法名书写保留动词，例如get，使用 * 表示名词，例如getById匹配描述为getBy*</p></li>
<li><p>参数根据实际情况灵活调整</p></li>
</ul>
</div>
<div class="section" id="id13">
<h3>五种通知类型<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>前置通知</p></li>
<li><p>后置通知</p></li>
<li><p>环绕通知（重点）</p>
<ul>
<li><p>环绕通知依赖形参 <code class="docutils literal notranslate"><span class="pre">ProceedingJoinPoint</span></code> 才能实现对原始方法的调用</p></li>
<li><p>环绕通知可以隔离原始方法的调用执行</p></li>
<li><p>环绕通知返回值设置为 <code class="docutils literal notranslate"><span class="pre">Object</span></code> 类型</p></li>
<li><p>环绕通知中可以对原始方法调用过程中出现的异常进行处理</p></li>
</ul>
</li>
<li><p>返回后通知</p></li>
<li><p>抛出异常后通知</p></li>
</ul>
</div>
<div class="section" id="id14">
<h3>通知中获取参数<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>获取切入点方法的参数，所有的通知类型都可以获取参数</p>
<ul>
<li><p>JoinPoint：适用于前置、后置、返回后、抛出异常后通知</p></li>
<li><p>ProceedingJoinPoint：适用于环绕通知</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>获取切入点方法返回值，前置和抛出异常后通知是没有返回值，后置通知可有可无</p>
<ul>
<li><p>返回后通知</p></li>
<li><p>环绕通知</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>获取切入点方法运行异常信息，前置和返回后通知是不会有，后置通知可有可无</p>
<ul>
<li><p>抛出异常后通知</p></li>
<li><p>环绕通知</p></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="aop_knowledge.html" class="btn btn-neutral float-right" title="9. AOP知识点" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../annotation/anno_knowledge.html" class="btn btn-neutral float-left" title="7. 注解知识点" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2021, linzzz.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>