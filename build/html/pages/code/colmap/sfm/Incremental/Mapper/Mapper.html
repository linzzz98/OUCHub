

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>1. Incremental_Mapper &mdash; OUCHub  æ–‡æ¡£</title>
  

  
  <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/twemoji.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/language_data.js"></script>
        <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"></script>
        <script src="../../../../../../_static/twemoji.js"></script>
        <script src="../../../../../../_static/translations.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="ç´¢å¼•" href="../../../../../../genindex.html" />
    <link rel="search" title="æœç´¢" href="../../../../../../search.html" />
    <link rel="next" title="ğŸ‘ TheiaSfM" href="../../../../theiasfm.html" />
    <link rel="prev" title="SfM Pipeline" href="../../../c_sfm.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> OUCHub
          

          
            
            <img src="../../../../../../_static/logo_2.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="åœ¨æ–‡æ¡£ä¸­æœç´¢" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">åŸºç¡€çŸ¥è¯†</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../knowledge/k_MH.html">ğŸ’Š Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../knowledge/k_CV.html">ğŸ¤ Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../knowledge/k_ML.html">ğŸ Machine Learning</a></li>
</ul>
<p class="caption"><span class="caption-text">è®ºæ–‡å­¦ä¹ </span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../paper/p_sfm.html">ğŸŠ Structure from Motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../paper/p_pointcloud.html">ğŸ‹ Point Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../paper/p_others.html">ğŸ’ Others</a></li>
</ul>
<p class="caption"><span class="caption-text">æºç è§£æ</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../colmap.html">ğŸ‘ Colmap</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../c_base.html">Base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../c_estimator.html">Estimator</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../c_sfm.html">SfM Pipeline</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">1. Incremental_Mapper</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">é…ç½®é€‰é¡¹</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">ç»“æ„ä½“</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">æˆå‘˜å˜é‡</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">æˆå‘˜å‡½æ•°</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#incrementalmapper">IncrementalMapper</a></li>
<li class="toctree-l5"><a class="reference internal" href="#beginreconstruction">BeginReconstruction</a></li>
<li class="toctree-l5"><a class="reference internal" href="#endrestruction">EndRestruction</a></li>
<li class="toctree-l5"><a class="reference internal" href="#findinitialimagepair">FindInitialImagePair</a></li>
<li class="toctree-l5"><a class="reference internal" href="#findfirstinitialimage">FindFirstInitialImage</a></li>
<li class="toctree-l5"><a class="reference internal" href="#findsecondinitialimage">FindSecondInitialImage</a></li>
<li class="toctree-l5"><a class="reference internal" href="#findnextimages">FindNextImages</a></li>
<li class="toctree-l5"><a class="reference internal" href="#findlocalbundle">FindLocalBundle</a></li>
<li class="toctree-l5"><a class="reference internal" href="#estimateinitialtwoviewgeometry">EstimateInitialTwoViewGeometry</a></li>
<li class="toctree-l5"><a class="reference internal" href="#registerinitialimagepair">RegisterInitialImagePair</a></li>
<li class="toctree-l5"><a class="reference internal" href="#registernextimage">RegisterNextImage</a></li>
<li class="toctree-l5"><a class="reference internal" href="#triangulate">Triangulate</a></li>
<li class="toctree-l5"><a class="reference internal" href="#adjustlocalbundle">AdjustLocalBundle</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../theiasfm.html">ğŸ‘ TheiaSfM</a></li>
</ul>
<p class="caption"><span class="caption-text">æ‚ä¸ƒæ‚å…«</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../others/o_others.html">ğŸº Others</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">OUCHub</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../colmap.html">ğŸ‘ Colmap</a> &raquo;</li>
        
          <li><a href="../../../c_sfm.html">SfM Pipeline</a> &raquo;</li>
        
      <li><span class="section-number">1. </span>Incremental_Mapper</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../../_sources/pages/code/colmap/sfm/Incremental/Mapper/Mapper.rst.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="incremental-mapper">
<h1><span class="section-number">1. </span>Incremental_Mapper<a class="headerlink" href="#incremental-mapper" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h1>
<p>ä¸ºå¢é‡é‡å»ºè¿‡ç¨‹æä¾›æ‰€æœ‰åŠŸèƒ½çš„ç±»</p>
<div class="admonition important">
<p class="admonition-title">é‡è¦</p>
<p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// æ„é€ ä¸€ä¸ªIncrementalMapperï¼Œè¯»å–æ•°æ®åº“çš„ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰</span>
<span class="n">IncrementalMapper</span> <span class="nf">mapper</span><span class="p">(</span><span class="o">&amp;</span><span class="n">database_cache</span><span class="p">);</span>

<span class="c1">// å¼€å§‹é‡å»º</span>
<span class="n">mapper</span><span class="p">.</span><span class="n">BeginReconstruction</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reconstruction</span><span class="p">);</span>

<span class="c1">// å‚æ•°æ£€æµ‹</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="n">FindInitialImagePair</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">image_id1</span><span class="p">,</span> <span class="n">image_id2</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="n">RegisterInitialImagePair</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">image_id1</span><span class="p">,</span> <span class="n">image_id2</span><span class="p">));</span>

<span class="c1">// å¢é‡å¼é‡å»ºï¼Œå¾ªç¯æ·»åŠ æ–°çš„å›¾ç‰‡</span>
<span class="k">while</span> <span class="p">(...)</span> <span class="p">{</span>

   <span class="c1">// æ‰¾åˆ°ä¸‹ä¸€ç»„æ·»åŠ çš„å›¾ç‰‡</span>
   <span class="k">const</span> <span class="k">auto</span> <span class="n">next_image_ids</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">.</span><span class="n">FindNextImages</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>

   <span class="c1">// å¾ªç¯æ·»åŠ </span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="nl">image_id</span> <span class="p">:</span> <span class="n">next_image_ids</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">CHECK</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="n">RegisterNextImage</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">image_id</span><span class="p">));</span>

      <span class="c1">// å±€éƒ¨BA</span>
      <span class="k">if</span> <span class="p">(...)</span> <span class="p">{</span>
         <span class="n">mapper</span><span class="p">.</span><span class="n">AdjustLocalBundle</span><span class="p">(...);</span>
      <span class="p">}</span>

      <span class="c1">// å…¨å±€BA</span>
      <span class="k">else</span> <span class="p">{</span>
         <span class="n">mapper</span><span class="p">.</span><span class="n">AdjustGlobalBundle</span><span class="p">(...);</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ç»“æŸé‡å»º</span>
<span class="n">mapper</span><span class="p">.</span><span class="n">EndReconstruction</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
</div>
<dl class="cpp class">
<dt id="_CPPv417IncrementalMapper">
<span id="_CPPv317IncrementalMapper"></span><span id="_CPPv217IncrementalMapper"></span><span id="IncrementalMapper"></span><em class="property">class </em><code class="sig-name descname">IncrementalMapper</code><a class="headerlink" href="#_CPPv417IncrementalMapper" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="section" id="id1">
<h2>é…ç½®é€‰é¡¹<a class="headerlink" href="#id1" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<dl class="cpp struct">
<dt id="_CPPv4N17IncrementalMapper7OptionsE">
<span id="_CPPv3N17IncrementalMapper7OptionsE"></span><span id="_CPPv2N17IncrementalMapper7OptionsE"></span><span id="IncrementalMapper::Options"></span><em class="property">struct </em><code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">Options</code><a class="headerlink" href="#_CPPv4N17IncrementalMapper7OptionsE" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp member">
<dt id="_CPPv420init_min_num_inliers">
<span id="_CPPv320init_min_num_inliers"></span><span id="_CPPv220init_min_num_inliers"></span><span id="init_min_num_inliers__i"></span>int <code class="sig-name descname">init_min_num_inliers</code> = 100;<a class="headerlink" href="#_CPPv420init_min_num_inliers" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>åˆå§‹å›¾åƒå¯¹çš„æœ€å°inliersæ•°</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv414init_max_error">
<span id="_CPPv314init_max_error"></span><span id="_CPPv214init_max_error"></span><span id="init_max_error__double"></span>double <code class="sig-name descname">init_max_error</code> = 4.0;<a class="headerlink" href="#_CPPv414init_max_error" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>åˆå§‹å›¾åƒå¯¹çš„ä¸¤è§†å›¾å‡ ä½•ä¼°è®¡çš„æœ€å¤§åƒç´ è¯¯å·®</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv423init_max_forward_motion">
<span id="_CPPv323init_max_forward_motion"></span><span id="_CPPv223init_max_forward_motion"></span><span id="init_max_forward_motion__double"></span>double <code class="sig-name descname">init_max_forward_motion</code> = 0.95;<a class="headerlink" href="#_CPPv423init_max_forward_motion" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>åˆå§‹å›¾åƒå¯¹çš„æœ€å¤§å‰ç§»ï¼ˆMaximum forward motion for initial image pairï¼‰</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv418init_min_tri_angle">
<span id="_CPPv318init_min_tri_angle"></span><span id="_CPPv218init_min_tri_angle"></span><span id="init_min_tri_angle__double"></span>double <code class="sig-name descname">init_min_tri_angle</code> = 16.0;<a class="headerlink" href="#_CPPv418init_min_tri_angle" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>åˆå§‹å›¾åƒå¯¹çš„æœ€å°ä¸‰è§’å‰–åˆ†è§’</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv419init_max_reg_trials">
<span id="_CPPv319init_max_reg_trials"></span><span id="_CPPv219init_max_reg_trials"></span><span id="init_max_reg_trials__i"></span>int <code class="sig-name descname">init_max_reg_trials</code> = 2;<a class="headerlink" href="#_CPPv419init_max_reg_trials" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>ä½¿ç”¨å›¾åƒè¿›è¡Œåˆå§‹åŒ–çš„æœ€å¤§å°è¯•æ¬¡æ•°</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv418abs_pose_max_error">
<span id="_CPPv318abs_pose_max_error"></span><span id="_CPPv218abs_pose_max_error"></span><span id="abs_pose_max_error__double"></span>double <code class="sig-name descname">abs_pose_max_error</code> = 12.0;<a class="headerlink" href="#_CPPv418abs_pose_max_error" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>ç»å¯¹ä½å§¿ä¼°è®¡ä¸­çš„æœ€å¤§é‡æŠ•å½±è¯¯å·®</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv424abs_pose_min_num_inliers">
<span id="_CPPv324abs_pose_min_num_inliers"></span><span id="_CPPv224abs_pose_min_num_inliers"></span><span id="abs_pose_min_num_inliers__i"></span>int <code class="sig-name descname">abs_pose_min_num_inliers</code> = 30;<a class="headerlink" href="#_CPPv424abs_pose_min_num_inliers" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>ç»å¯¹ä½å§¿ä¼°è®¡ä¸­çš„æœ€å°inliersæ•°</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv425abs_pose_min_inlier_ratio">
<span id="_CPPv325abs_pose_min_inlier_ratio"></span><span id="_CPPv225abs_pose_min_inlier_ratio"></span><span id="abs_pose_min_inlier_ratio__double"></span>double <code class="sig-name descname">abs_pose_min_inlier_ratio</code> = 0.25;<a class="headerlink" href="#_CPPv425abs_pose_min_inlier_ratio" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>ç»å¯¹ä½å§¿ä¼°è®¡ä¸­çš„æœ€å°inliersæ¯”ç‡</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv428abs_pose_refine_focal_length">
<span id="_CPPv328abs_pose_refine_focal_length"></span><span id="_CPPv228abs_pose_refine_focal_length"></span><span id="abs_pose_refine_focal_length__b"></span>bool <code class="sig-name descname">abs_pose_refine_focal_length</code> = true;<a class="headerlink" href="#_CPPv428abs_pose_refine_focal_length" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>æ˜¯å¦åœ¨ç»å¯¹ä½å§¿ä¼°è®¡ä¸­ä¼°è®¡ç„¦è·</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv428abs_pose_refine_extra_params">
<span id="_CPPv328abs_pose_refine_extra_params"></span><span id="_CPPv228abs_pose_refine_extra_params"></span><span id="abs_pose_refine_extra_params__b"></span>bool <code class="sig-name descname">abs_pose_refine_extra_params</code> = true;<a class="headerlink" href="#_CPPv428abs_pose_refine_extra_params" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>æ˜¯å¦åœ¨ç»å¯¹ä½å§¿ä¼°è®¡ä¸­ä¼°è®¡é¢å¤–å‚æ•°</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv419local_ba_num_images">
<span id="_CPPv319local_ba_num_images"></span><span id="_CPPv219local_ba_num_images"></span><span id="local_ba_num_images__i"></span>int <code class="sig-name descname">local_ba_num_images</code> = 6;<a class="headerlink" href="#_CPPv419local_ba_num_images" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>åœ¨å±€éƒ¨BAè°ƒæ•´ä¸­è¦ä¼˜åŒ–çš„å›¾åƒæ•°</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv422local_ba_min_tri_angle">
<span id="_CPPv322local_ba_min_tri_angle"></span><span id="_CPPv222local_ba_min_tri_angle"></span><span id="local_ba_min_tri_angle__double"></span>double <code class="sig-name descname">local_ba_min_tri_angle</code> = 6;<a class="headerlink" href="#_CPPv422local_ba_min_tri_angle" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>åœ¨å±€éƒ¨BAè°ƒæ•´ä¸­é€‰æ‹©å›¾åƒçš„æœ€å°ä¸‰è§’å‰–åˆ†</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv422min_focal_length_ratio">
<span id="_CPPv322min_focal_length_ratio"></span><span id="_CPPv222min_focal_length_ratio"></span><span id="min_focal_length_ratio__double"></span>double <code class="sig-name descname">min_focal_length_ratio</code> = 0.1;<a class="headerlink" href="#_CPPv422min_focal_length_ratio" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp member">
<dt id="_CPPv422max_focal_length_ratio">
<span id="_CPPv322max_focal_length_ratio"></span><span id="_CPPv222max_focal_length_ratio"></span><span id="max_focal_length_ratio__double"></span>double <code class="sig-name descname">max_focal_length_ratio</code> = 10;<a class="headerlink" href="#_CPPv422max_focal_length_ratio" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp member">
<dt id="_CPPv415max_extra_param">
<span id="_CPPv315max_extra_param"></span><span id="_CPPv215max_extra_param"></span><span id="max_extra_param__double"></span>double <code class="sig-name descname">max_extra_param</code> = 1;<a class="headerlink" href="#_CPPv415max_extra_param" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>ä¼ªé€ ç›¸æœºå‚æ•°çš„é˜ˆå€¼ã€‚ å¸¦æœ‰ä¼ªé€ ç›¸æœºå‚æ•°çš„å›¾åƒåœ¨ä¸‰è§’å‰–åˆ†ä¸­è¢«è¿‡æ»¤å¹¶è¢«å¿½ç•¥</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv423filter_max_reproj_error">
<span id="_CPPv323filter_max_reproj_error"></span><span id="_CPPv223filter_max_reproj_error"></span><span id="filter_max_reproj_error__double"></span>double <code class="sig-name descname">filter_max_reproj_error</code> = 4.0;<a class="headerlink" href="#_CPPv423filter_max_reproj_error" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>ç”¨äºè§‚å¯Ÿçš„æœ€å¤§é‡æŠ•å½±è¯¯å·®ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv420filter_min_tri_angle">
<span id="_CPPv320filter_min_tri_angle"></span><span id="_CPPv220filter_min_tri_angle"></span><span id="filter_min_tri_angle__double"></span>double <code class="sig-name descname">filter_min_tri_angle</code> = 1.5;<a class="headerlink" href="#_CPPv420filter_min_tri_angle" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>ç¨³å®š3Dç‚¹çš„æœ€å°ä¸‰è§’å‰–åˆ†è§’åº¦ï¼ˆä»¥åº¦ä¸ºå•ä½ï¼‰</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv414max_reg_trials">
<span id="_CPPv314max_reg_trials"></span><span id="_CPPv214max_reg_trials"></span><span id="max_reg_trials__i"></span>int <code class="sig-name descname">max_reg_trials</code> = 3;<a class="headerlink" href="#_CPPv414max_reg_trials" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>æ³¨å†Œå›¾åƒçš„æœ€å¤§å°è¯•æ¬¡æ•°</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv419fix_existing_images">
<span id="_CPPv319fix_existing_images"></span><span id="_CPPv219fix_existing_images"></span><span id="fix_existing_images__b"></span>bool <code class="sig-name descname">fix_existing_images</code> = false;<a class="headerlink" href="#_CPPv419fix_existing_images" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>æä¾›é‡å»ºä½œä¸ºè¾“å…¥ï¼Œæ˜¯å¦ä¿®å¤ç°å­˜çš„å›¾åƒä½å§¿</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv411num_threads">
<span id="_CPPv311num_threads"></span><span id="_CPPv211num_threads"></span><span id="num_threads__i"></span>int <code class="sig-name descname">num_threads</code> = -1;<a class="headerlink" href="#_CPPv411num_threads" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>çº¿ç¨‹æ•°</p>
</dd></dl>

<dl class="cpp enum">
<dt id="_CPPv420ImageSelectionMethod">
<span id="_CPPv320ImageSelectionMethod"></span><span id="_CPPv220ImageSelectionMethod"></span><em class="property">enum </em><code class="sig-name descname">ImageSelectionMethod</code><a class="headerlink" href="#_CPPv420ImageSelectionMethod" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>æŸ¥æ‰¾å¹¶é€‰æ‹©ä¸‹ä¸€ä¸ªæœ€ä½³å›¾åƒè¿›è¡Œæ³¨å†Œçš„æ–¹æ³•</p>
<dl class="field-list simple">
<dt class="field-odd">ImageSelectionMethod</dt>
<dd class="field-odd"><ul class="simple">
<li><p>MAX_VISIBLE_POINTS_NUM</p></li>
<li><p>MAX_VISIBLE_POINTS_RATIO</p></li>
<li><p>MIN_UNCERTAINTY</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="id2">
<h2>ç»“æ„ä½“<a class="headerlink" href="#id2" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<dl class="cpp struct">
<dt id="_CPPv427LocalBundleAdjustmentReport">
<span id="_CPPv327LocalBundleAdjustmentReport"></span><span id="_CPPv227LocalBundleAdjustmentReport"></span><span id="LocalBundleAdjustmentReport"></span><em class="property">struct </em><code class="sig-name descname">LocalBundleAdjustmentReport</code><a class="headerlink" href="#_CPPv427LocalBundleAdjustmentReport" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">LocalBundleAdjustmentReport</span> <span class="p">{</span>
   <span class="kt">size_t</span> <span class="n">num_merged_observations</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="kt">size_t</span> <span class="n">num_completed_observations</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="kt">size_t</span> <span class="n">num_filtered_observations</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="kt">size_t</span> <span class="n">num_adjusted_observations</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>æˆå‘˜å˜é‡<a class="headerlink" href="#id3" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<dl class="cpp member">
<dt id="_CPPv415database_cache_">
<span id="_CPPv315database_cache_"></span><span id="_CPPv215database_cache_"></span><span id="database_cache___DatabaseCacheCP"></span><em class="property">const</em> DatabaseCache *<code class="sig-name descname">database_cache_</code>;<a class="headerlink" href="#_CPPv415database_cache_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>è¯¥ç±»å°†æ•°æ®åº“ä¸­æ‰€æœ‰å¿…éœ€çš„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv415reconstruction_">
<span id="_CPPv315reconstruction_"></span><span id="_CPPv215reconstruction_"></span><span id="reconstruction___colmap::ReconstructionP"></span>colmap::Reconstruction *<code class="sig-name descname">reconstruction_</code>;<a class="headerlink" href="#_CPPv415reconstruction_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>ä¿å­˜é‡å»ºæ•°æ®çš„ç±»</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv413triangulator_">
<span id="_CPPv313triangulator_"></span><span id="_CPPv213triangulator_"></span><span id="triangulator___std::unique_ptr:IncrementalTriangulator:"></span>std::unique_ptr&lt;IncrementalTriangulator&gt; <code class="sig-name descname">triangulator_</code>;<a class="headerlink" href="#_CPPv413triangulator_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>è´Ÿè´£å¢é‡ä¸‰è§’å‰–åˆ†çš„ç±»</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv421num_total_reg_images_">
<span id="_CPPv321num_total_reg_images_"></span><span id="_CPPv221num_total_reg_images_"></span><span id="num_total_reg_images___s"></span>size_t <code class="sig-name descname">num_total_reg_images_</code>;<a class="headerlink" href="#_CPPv421num_total_reg_images_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>è‡³å°‘åœ¨é‡å»ºæ—¶æ³¨å†Œçš„å›¾åƒæ•°é‡</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv422num_shared_reg_images_">
<span id="_CPPv322num_shared_reg_images_"></span><span id="_CPPv222num_shared_reg_images_"></span><span id="num_shared_reg_images___s"></span>size_t <code class="sig-name descname">num_shared_reg_images_</code>;<a class="headerlink" href="#_CPPv422num_shared_reg_images_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>å½“å‰é‡å»ºå’Œæ‰€æœ‰å…¶ä»–å…ˆå‰é‡å»ºä¹‹é—´å…±äº«å›¾åƒçš„æ•°é‡</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv424prev_init_image_pair_id_">
<span id="_CPPv324prev_init_image_pair_id_"></span><span id="_CPPv224prev_init_image_pair_id_"></span><span id="prev_init_image_pair_id___image_pair_t"></span>image_pair_t <code class="sig-name descname">prev_init_image_pair_id_</code>;<a class="headerlink" href="#_CPPv424prev_init_image_pair_id_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp member">
<dt id="_CPPv428prev_init_two_view_geometry_">
<span id="_CPPv328prev_init_two_view_geometry_"></span><span id="_CPPv228prev_init_two_view_geometry_"></span><span id="prev_init_two_view_geometry___TwoViewGeometry"></span><a class="reference internal" href="../../../estimator/TwoViewGeometry/TwoViewGeometry.html#_CPPv415TwoViewGeometry" title="TwoViewGeometry">TwoViewGeometry</a> <code class="sig-name descname">prev_init_two_view_geometry_</code>;<a class="headerlink" href="#_CPPv428prev_init_two_view_geometry_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>ä¸Šä¸€æ¬¡è°ƒç”¨ <code class="docutils literal notranslate"><span class="pre">FindFirstInitialImage</span></code> çš„ä¼°è®¡ä¸¤è§†å›¾å‡ ä½•ä½“ï¼Œç”¨ä½œä»¥åè°ƒç”¨ <code class="docutils literal notranslate"><span class="pre">RegisterInitialImagePair</span></code> çš„ç¼“å­˜ã€‚</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv420init_num_reg_trials_">
<span id="_CPPv320init_num_reg_trials_"></span><span id="_CPPv220init_num_reg_trials_"></span><span id="init_num_reg_trials___std::unordered_map:image_t.s:"></span>std::unordered_map&lt;image_t, size_t&gt; <code class="sig-name descname">init_num_reg_trials_</code>;<a class="headerlink" href="#_CPPv420init_num_reg_trials_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<dl class="cpp member">
<dt id="_CPPv417init_image_pairs_">
<span id="_CPPv317init_image_pairs_"></span><span id="_CPPv217init_image_pairs_"></span><span id="init_image_pairs___std::unordered_set:image_pair_t:"></span>std::unordered_set&lt;image_pair_t&gt; <code class="sig-name descname">init_image_pairs_</code>;<a class="headerlink" href="#_CPPv417init_image_pairs_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>å·²ç”¨äºåˆå§‹åŒ–çš„å›¾åƒå’Œå›¾åƒå¯¹ã€‚ æ¯ä¸ªå›¾åƒå’Œå›¾åƒå¯¹ä»…å°è¯•ä¸€æ¬¡è¿›è¡Œåˆå§‹åŒ–ã€‚</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv426num_reg_images_per_camera_">
<span id="_CPPv326num_reg_images_per_camera_"></span><span id="_CPPv226num_reg_images_per_camera_"></span><span id="num_reg_images_per_camera___std::unordered_map:camera_t.s:"></span>std::unordered_map&lt;camera_t, size_t&gt; <code class="sig-name descname">num_reg_images_per_camera_</code>;<a class="headerlink" href="#_CPPv426num_reg_images_per_camera_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>æ¯ä¸ªæ‘„åƒæœºçš„å·²æ³¨å†Œå›¾åƒæ•°ã€‚</p>
<p>å½“å¤šä¸ªå›¾åƒå…±äº«å†…å‚æ—¶ï¼Œæ­¤ä¿¡æ¯ç”¨äºé¿å…é‡å¤ä¼˜åŒ–æ‘„åƒæœºå‚æ•°ä»¥åŠåœ¨å±€éƒ¨BAè°ƒæ•´ä¸­é™ä½å·²ä¼˜åŒ–æ‘„åƒæœºå‚æ•°çš„æ€§èƒ½ã€‚</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv418num_registrations_">
<span id="_CPPv318num_registrations_"></span><span id="_CPPv218num_registrations_"></span><span id="num_registrations___std::unordered_map:image_t.s:"></span>std::unordered_map&lt;image_t, size_t&gt; <code class="sig-name descname">num_registrations_</code>;<a class="headerlink" href="#_CPPv418num_registrations_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>æ³¨å†Œå›¾åƒçš„é‡å»ºæ¬¡æ•°</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv416filtered_images_">
<span id="_CPPv316filtered_images_"></span><span id="_CPPv216filtered_images_"></span><span id="filtered_images___std::unordered_set:image_t:"></span>std::unordered_set&lt;image_t&gt; <code class="sig-name descname">filtered_images_</code>;<a class="headerlink" href="#_CPPv416filtered_images_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>å½“å‰é‡å»ºä¸­å·²è¿‡æ»¤çš„å›¾åƒ</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv415num_reg_trials_">
<span id="_CPPv315num_reg_trials_"></span><span id="_CPPv215num_reg_trials_"></span><span id="num_reg_trials___std::unordered_map:image_t.s:"></span>std::unordered_map&lt;image_t, size_t&gt; <code class="sig-name descname">num_reg_trials_</code>;<a class="headerlink" href="#_CPPv415num_reg_trials_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>åœ¨å½“å‰é‡å»ºä¸­æ³¨å†Œå›¾åƒçš„è¯•éªŒæ¬¡æ•°ã€‚</p>
<p>ç”¨äºè®¾ç½®æ³¨å†Œå›¾åƒçš„å°è¯•æ¬¡æ•°çš„ä¸Šé™ã€‚</p>
</dd></dl>

<dl class="cpp member">
<dt id="_CPPv419existing_image_ids_">
<span id="_CPPv319existing_image_ids_"></span><span id="_CPPv219existing_image_ids_"></span><span id="existing_image_ids___std::unordered_set:image_t:"></span>std::unordered_set&lt;image_t&gt; <code class="sig-name descname">existing_image_ids_</code>;<a class="headerlink" href="#_CPPv419existing_image_ids_" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd><p>å¼€å§‹é‡å»ºä¹‹å‰å·²æ³¨å†Œçš„å›¾åƒã€‚</p>
<p>å¦‚æœä»ç°æœ‰é‡å»ºç»§ç»­è¿›è¡Œé‡å»ºï¼Œåˆ™æ­¤å›¾åƒåˆ—è¡¨å°†ä¸ºéç©ºã€‚</p>
</dd></dl>

</div>
<div class="section" id="id4">
<h2>æˆå‘˜å‡½æ•°<a class="headerlink" href="#id4" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<div class="section" id="incrementalmapper">
<h3>IncrementalMapper<a class="headerlink" href="#incrementalmapper" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<blockquote>
<div><p>æ„é€ å‡½æ•°ï¼Œåˆ›å»ºå¢é‡æ˜ å°„å™¨ã€‚ æ•°æ®åº“ç¼“å­˜å¿…é¡»åœ¨å¢é‡æ˜ å°„å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½æœ‰æ•ˆã€‚</p>
</div></blockquote>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper17IncrementalMapperEPK13DatabaseCache">
<span id="_CPPv3N17IncrementalMapper17IncrementalMapperEPK13DatabaseCache"></span><span id="_CPPv2N17IncrementalMapper17IncrementalMapperEPK13DatabaseCache"></span><span id="IncrementalMapper::IncrementalMapper__DatabaseCacheCP"></span><em class="property">explicit</em> <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv4N17IncrementalMapper17IncrementalMapperEPK13DatabaseCache" title="IncrementalMapper::IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">IncrementalMapper</code><span class="sig-paren">(</span><em class="property">const</em> DatabaseCache *<em>database_cache</em><span class="sig-paren">)</span>;<a class="headerlink" href="#_CPPv4N17IncrementalMapper17IncrementalMapperEPK13DatabaseCache" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">IncrementalMapper</span><span class="p">(</span><span class="k">const</span> <span class="n">DatabaseCache</span><span class="o">*</span> <span class="n">database_cache</span><span class="p">)</span>
 <span class="o">:</span> <span class="n">database_cache_</span><span class="p">(</span><span class="n">database_cache</span><span class="p">),</span>
   <span class="n">reconstruction_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span>
   <span class="n">triangulator_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span>
   <span class="n">num_total_reg_images_</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
   <span class="n">num_shared_reg_images_</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
   <span class="n">prev_init_image_pair_id_</span><span class="p">(</span><span class="n">kInvalidImagePairId</span><span class="p">)</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
<div class="section" id="beginreconstruction">
<h3>BeginReconstruction<a class="headerlink" href="#beginreconstruction" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper19BeginReconstructionEP14Reconstruction">
<span id="_CPPv3N17IncrementalMapper19BeginReconstructionEP14Reconstruction"></span><span id="_CPPv2N17IncrementalMapper19BeginReconstructionEP14Reconstruction"></span><span id="IncrementalMapper::BeginReconstruction__ReconstructionP"></span>void <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">BeginReconstruction</code><span class="sig-paren">(</span><a class="reference internal" href="../../../base/Reconstruction/Reconstruction.html#_CPPv414Reconstruction" title="Reconstruction">Reconstruction</a> *<em>reconstruction</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper19BeginReconstructionEP14Reconstruction" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">BeginReconstruction</span><span class="p">(</span><span class="n">Reconstruction</span><span class="o">*</span> <span class="n">reconstruction</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK</span><span class="p">(</span><span class="n">reconstruction_</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">);</span>
   <span class="n">reconstruction_</span> <span class="o">=</span> <span class="n">reconstruction</span><span class="p">;</span>

   <span class="c1">// ä»æ•°æ®åº“ä¸­åŠ è½½ç¼“å­˜</span>
   <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Load</span><span class="p">(</span><span class="o">*</span><span class="n">database_cache_</span><span class="p">);</span>

   <span class="c1">// å¼€å§‹æ„å»ºé‡å»º</span>
   <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">SetUp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">CorrespondenceGraph</span><span class="p">());</span>

   <span class="c1">// è®¾ç½®ä¸‰è§’å‰–åˆ†ç±»</span>
   <span class="n">triangulator_</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="n">IncrementalTriangulator</span><span class="p">(</span>
      <span class="o">&amp;</span><span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">CorrespondenceGraph</span><span class="p">(),</span> <span class="n">reconstruction</span><span class="p">));</span>

   <span class="n">num_shared_reg_images_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">num_reg_images_per_camera_</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

   <span class="c1">// æ³¨å†Œå›¾åƒ</span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">image_t</span> <span class="nl">image_id</span> <span class="p">:</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">RegImageIds</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">RegisterImageEvent</span><span class="p">(</span><span class="n">image_id</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="c1">// è®¾ç½®å·²ç»å­˜åœ¨äºé‡å»ºä¸­çš„å›¾åƒid</span>
   <span class="n">existing_image_ids_</span> <span class="o">=</span>
      <span class="n">std</span><span class="o">::</span><span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">reconstruction</span><span class="o">-&gt;</span><span class="n">RegImageIds</span><span class="p">().</span><span class="n">begin</span><span class="p">(),</span>
                                  <span class="n">reconstruction</span><span class="o">-&gt;</span><span class="n">RegImageIds</span><span class="p">().</span><span class="n">end</span><span class="p">());</span>

   <span class="c1">// è®¾ç½®ä¸Šä¸€æ¬¡è°ƒç”¨indFirstInitialImageçš„ä¼°è®¡ä¸¤è§†å›¾å‡ ä½•ä½“çš„idå’Œä¸¤è§†å›¾å‡ ä½•ä¸ºç©º</span>
   <span class="n">prev_init_image_pair_id_</span> <span class="o">=</span> <span class="n">kInvalidImagePairId</span><span class="p">;</span>
   <span class="n">prev_init_two_view_geometry_</span> <span class="o">=</span> <span class="n">TwoViewGeometry</span><span class="p">();</span>

   <span class="n">filtered_images_</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
   <span class="n">num_reg_trials_</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="endrestruction">
<h3>EndRestruction<a class="headerlink" href="#endrestruction" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<blockquote>
<div><p>å½“å‰é‡å»ºå®Œæˆåï¼Œæ¸…ç†æ˜ å°„å™¨ã€‚</p>
<p>å¦‚æœä¸¢å¼ƒè¯¥æ¨¡å‹ï¼Œåˆ™å°†ç›¸åº”æ›´æ–°æ€»å’Œå…±äº«æ³¨å†Œå›¾åƒçš„æ•°é‡ã€‚</p>
</div></blockquote>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper17EndReconstructionEKb">
<span id="_CPPv3N17IncrementalMapper17EndReconstructionEKb"></span><span id="_CPPv2N17IncrementalMapper17EndReconstructionEKb"></span><span id="IncrementalMapper::EndReconstruction__bC"></span>void <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">EndReconstruction</code><span class="sig-paren">(</span><em class="property">const</em> bool <em>discard</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper17EndReconstructionEKb" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">EndReconstruction</span><span class="p">(</span><span class="k">const</span> <span class="kt">bool</span> <span class="n">discard</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>

   <span class="c1">// å¦‚æœä¸¢å¼ƒæ¨¡å‹</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">discard</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// è§£æ³¨å†Œå›¾åƒid</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">image_t</span> <span class="nl">image_id</span> <span class="p">:</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">RegImageIds</span><span class="p">())</span> <span class="p">{</span>
         <span class="n">DeRegisterImageEvent</span><span class="p">(</span><span class="n">image_id</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="c1">// æ¸…ç†é‡å»ºæ˜ å°„å™¨</span>
   <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">TearDown</span><span class="p">();</span>
   <span class="n">reconstruction_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
   <span class="n">triangulator_</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="findinitialimagepair">
<h3>FindInitialImagePair<a class="headerlink" href="#findinitialimagepair" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<blockquote>
<div><p>æŸ¥æ‰¾åˆå§‹å›¾åƒå¯¹ä¸ºå¢é‡é‡å»ºæä¾›ç§å­ã€‚ å›¾åƒå¯¹åº”è¯¥ä¼ é€’ç»™ <code class="docutils literal notranslate"><span class="pre">RegisterInitialImagePair</span></code> ã€‚</p>
<p>æ­¤å‡½æ•°ä¼šè‡ªåŠ¨å¿½ç•¥å…ˆå‰æ— æ³•æ³¨å†Œçš„å›¾åƒå¯¹ã€‚</p>
</div></blockquote>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper20FindInitialImagePairERK7OptionsP7image_tP7image_t">
<span id="_CPPv3N17IncrementalMapper20FindInitialImagePairERK7OptionsP7image_tP7image_t"></span><span id="_CPPv2N17IncrementalMapper20FindInitialImagePairERK7OptionsP7image_tP7image_t"></span><span id="IncrementalMapper::FindInitialImagePair__OptionsCR.image_tP.image_tP"></span>bool <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">FindInitialImagePair</code><span class="sig-paren">(</span><em class="property">const</em> <a class="reference internal" href="#_CPPv4N17IncrementalMapper7OptionsE" title="IncrementalMapper::Options">Options</a> &amp;<em>options</em>, image_t *<em>image_id1</em>, image_t *<em>image_id2</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper20FindInitialImagePairERK7OptionsP7image_tP7image_t" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">FindInitialImagePair</span><span class="p">(</span><span class="k">const</span> <span class="n">Options</span><span class="o">&amp;</span> <span class="n">options</span><span class="p">,</span>
                                             <span class="n">image_t</span><span class="o">*</span> <span class="n">image_id1</span><span class="p">,</span>
                                             <span class="n">image_t</span><span class="o">*</span> <span class="n">image_id2</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Check</span><span class="p">());</span>

   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">image_ids1</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">image_id1</span> <span class="o">!=</span> <span class="n">kInvalidImageId</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">image_id2</span> <span class="o">==</span> <span class="n">kInvalidImageId</span><span class="p">)</span> <span class="p">{</span>

     <span class="c1">// ä»…æä¾›* image_id1</span>
     <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">ExistsImage</span><span class="p">(</span><span class="o">*</span><span class="n">image_id1</span><span class="p">))</span> <span class="p">{</span>
       <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">image_ids1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="n">image_id1</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">image_id1</span> <span class="o">==</span> <span class="n">kInvalidImageId</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">image_id2</span> <span class="o">!=</span> <span class="n">kInvalidImageId</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// ä»…æä¾›* image_id2</span>
     <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">ExistsImage</span><span class="p">(</span><span class="o">*</span><span class="n">image_id2</span><span class="p">))</span> <span class="p">{</span>
       <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">image_ids1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="n">image_id2</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">else</span> <span class="p">{</span>
     <span class="c1">// æ²¡æœ‰æä¾›åˆå§‹ç§å­å›¾åƒ</span>
     <span class="n">image_ids1</span> <span class="o">=</span> <span class="n">FindFirstInitialImage</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="c1">// å°è¯•æ‰¾åˆ°å¥½çš„åˆå§‹å¯¹</span>
   <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">image_ids1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i1</span><span class="p">)</span> <span class="p">{</span>
     <span class="o">*</span><span class="n">image_id1</span> <span class="o">=</span> <span class="n">image_ids1</span><span class="p">[</span><span class="n">i1</span><span class="p">];</span>

     <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">image_ids2</span> <span class="o">=</span>
         <span class="n">FindSecondInitialImage</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="o">*</span><span class="n">image_id1</span><span class="p">);</span>

     <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">image_ids2</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i2</span><span class="p">)</span> <span class="p">{</span>
       <span class="o">*</span><span class="n">image_id2</span> <span class="o">=</span> <span class="n">image_ids2</span><span class="p">[</span><span class="n">i2</span><span class="p">];</span>

       <span class="k">const</span> <span class="n">image_pair_t</span> <span class="n">pair_id</span> <span class="o">=</span>
           <span class="n">Database</span><span class="o">::</span><span class="n">ImagePairToPairId</span><span class="p">(</span><span class="o">*</span><span class="n">image_id1</span><span class="p">,</span> <span class="o">*</span><span class="n">image_id2</span><span class="p">);</span>

       <span class="c1">// æ¯å¯¹ä»…å°è¯•ä¸€æ¬¡</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">init_image_pairs_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">pair_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">continue</span><span class="p">;</span>
       <span class="p">}</span>

       <span class="n">init_image_pairs_</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pair_id</span><span class="p">);</span>

       <span class="k">if</span> <span class="p">(</span><span class="n">EstimateInitialTwoViewGeometry</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="o">*</span><span class="n">image_id1</span><span class="p">,</span> <span class="o">*</span><span class="n">image_id2</span><span class="p">))</span> <span class="p">{</span>
         <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
       <span class="p">}</span>
     <span class="p">}</span>
   <span class="p">}</span>

   <span class="c1">// åœ¨æ•´ä¸ªæ•°æ®é›†ä¸­æ‰¾ä¸åˆ°åˆé€‚çš„å¯¹ï¼Œè¿”å›é”™è¯¯</span>
   <span class="o">*</span><span class="n">image_id1</span> <span class="o">=</span> <span class="n">kInvalidImageId</span><span class="p">;</span>
   <span class="o">*</span><span class="n">image_id2</span> <span class="o">=</span> <span class="n">kInvalidImageId</span><span class="p">;</span>

   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="findfirstinitialimage">
<h3>FindFirstInitialImage<a class="headerlink" href="#findfirstinitialimage" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>æŸ¥æ‰¾ç”¨äºå¢é‡é‡å»ºçš„ç§å­å›¾åƒã€‚ åˆé€‚çš„ç§å­å›¾åƒå…·æœ‰å¤§é‡å¯¹åº”å…³ç³»ï¼Œå¹¶ä¸”å…·æœ‰ç›¸æœºæ ¡å‡†å…ˆéªŒã€‚ è¿”å›åˆ—è¡¨çš„æ’åºåº”ä½¿æœ€åˆé€‚çš„å›¾åƒä½äºæœ€å‰é¢ã€‚</p>
<dl class="cpp function">
<dt id="_CPPv4NK17IncrementalMapper21FindFirstInitialImageERK7Options">
<span id="_CPPv3NK17IncrementalMapper21FindFirstInitialImageERK7Options"></span><span id="_CPPv2NK17IncrementalMapper21FindFirstInitialImageERK7Options"></span><span id="IncrementalMapper::FindFirstInitialImage__OptionsCRC"></span>std::vector&lt;image_t&gt; <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">FindFirstInitialImage</code><span class="sig-paren">(</span><em class="property">const</em> <a class="reference internal" href="#_CPPv4N17IncrementalMapper7OptionsE" title="IncrementalMapper::Options">Options</a> &amp;<em>options</em><span class="sig-paren">)</span> <em class="property">const</em>;<a class="headerlink" href="#_CPPv4NK17IncrementalMapper21FindFirstInitialImageERK7Options" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">FindFirstInitialImage</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">Options</span><span class="o">&amp;</span> <span class="n">options</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>

  <span class="c1">// ä¿ç•™å…ƒæ•°æ®ï¼ˆmeta-dataï¼‰ä»¥å¯¹å›¾åƒè¿›è¡Œæ’åçš„ç»“æ„</span>
  <span class="k">struct</span> <span class="n">ImageInfo</span> <span class="p">{</span>
    <span class="n">image_t</span> <span class="n">image_id</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">prior_focal_length</span><span class="p">;</span>
    <span class="n">image_t</span> <span class="n">num_correspondences</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="k">const</span> <span class="kt">size_t</span> <span class="n">init_max_reg_trials</span> <span class="o">=</span>
      <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">init_max_reg_trials</span><span class="p">);</span>

  <span class="c1">// æ”¶é›†æ‰€æœ‰å°šæœªæ³¨å†Œçš„å›¾åƒçš„å¯¹åº”ä¿¡æ¯</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ImageInfo</span><span class="o">&gt;</span> <span class="n">image_infos</span><span class="p">;</span>
  <span class="n">image_infos</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">NumImages</span><span class="p">());</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">image</span> <span class="p">:</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Images</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// åªèƒ½æ³¨å†Œå…·æœ‰å¯¹åº”å…³ç³»çš„å›¾åƒ</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">NumCorrespondences</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// å›¾åƒåˆå§‹åŒ–çš„æ¬¡æ•°ä¸èƒ½è¶…è¿‡è§„å®šæ¬¡æ•°</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">init_num_reg_trials_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="n">init_num_reg_trials_</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">init_max_reg_trials</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ä»…ä½¿ç”¨æœªåœ¨ä»»ä½•å…¶ä»–é‡æ„ä¸­æ³¨å†Œçš„å›¾åƒè¿›è¡Œåˆå§‹åŒ–</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">num_registrations_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
        <span class="n">num_registrations_</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="k">class</span> <span class="nc">Camera</span><span class="o">&amp;</span> <span class="n">camera</span> <span class="o">=</span>
        <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">CameraId</span><span class="p">());</span>
    <span class="n">ImageInfo</span> <span class="n">image_info</span><span class="p">;</span>
    <span class="n">image_info</span><span class="p">.</span><span class="n">image_id</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
    <span class="n">image_info</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">HasPriorFocalLength</span><span class="p">();</span>
    <span class="n">image_info</span><span class="p">.</span><span class="n">num_correspondences</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">NumCorrespondences</span><span class="p">();</span>
    <span class="n">image_infos</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">image_info</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// å¯¹å›¾åƒè¿›è¡Œæ’åºï¼Œä½¿å…·æœ‰ä¼˜å…ˆç„¦è·å’Œæ›´å¤šå¯¹åº”å…³ç³»çš„å›¾åƒæˆä¸ºé¦–é€‰ï¼Œå³å®ƒä»¬å‡ºç°åœ¨åˆ—è¡¨çš„å‰é¢</span>
  <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span>
      <span class="n">image_infos</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">image_infos</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
      <span class="p">[](</span><span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="n">image_info1</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="n">image_info2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_info1</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">image_info2</span><span class="p">.</span><span class="n">prior_focal_length</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">image_info1</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">&amp;&amp;</span>
                   <span class="n">image_info2</span><span class="p">.</span><span class="n">prior_focal_length</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">image_info1</span><span class="p">.</span><span class="n">num_correspondences</span> <span class="o">&gt;</span>
                 <span class="n">image_info2</span><span class="p">.</span><span class="n">num_correspondences</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>

  <span class="c1">// æŒ‰æ’åºé¡ºåºæå–å›¾åƒæ ‡è¯†ç¬¦</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">image_ids</span><span class="p">;</span>
  <span class="n">image_ids</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">image_infos</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="nl">image_info</span> <span class="p">:</span> <span class="n">image_infos</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">image_ids</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">image_info</span><span class="p">.</span><span class="n">image_id</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">image_ids</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">æ³¨è§£</p>
<ol class="arabic">
<li><p>å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ç”¨äºå­˜å‚¨å›¾åƒçš„idã€æ˜¯å¦å…·æœ‰å…ˆéªŒç„¦è·ã€å¯¹åº”å…³ç³»æ•°</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">ImageInfo</span> <span class="p">{</span>
   <span class="n">image_t</span> <span class="n">image_id</span><span class="p">;</span>
   <span class="kt">bool</span> <span class="n">prior_focal_length</span><span class="p">;</span>
   <span class="n">image_t</span> <span class="n">num_correspondences</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>å®šä¹‰å°è¯•æ³¨å†Œçš„æœ€å¤§æ¬¡æ•°</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">size_t</span> <span class="n">init_max_reg_trials</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">init_max_reg_trials</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>éå†é‡å»ºä¸­çš„æ¯å¼ å›¾åƒï¼Œå°†ç¬¦åˆè¦æ±‚çš„å›¾ç‰‡åŠ å…¥åˆ° <code class="docutils literal notranslate"><span class="pre">image_infos</span></code> ä¸­</p>
<dl class="field-list">
<dt class="field-odd">è¦æ±‚</dt>
<dd class="field-odd"><p><strong>1. å¯¹åº”å…³ç³»</strong> âœ”ï¸</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">NumCorrespondences</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>2. å°è¯•æ¬¡æ•°å°‘äºé˜ˆå€¼</strong> âœ”ï¸</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">init_num_reg_trials_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
    <span class="n">init_num_reg_trials_</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">init_max_reg_trials</span><span class="p">)</span>

<span class="k">continue</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>3. æœªåœ¨å…¶ä»–é‡æ„ä¸­æ³¨å†Œ</strong> âœ”ï¸</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">num_registrations_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
    <span class="n">num_registrations_</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">continue</span><span class="p">;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>å¯¹ <code class="docutils literal notranslate"><span class="pre">image_infos</span></code> ä¸­çš„å›¾ç‰‡è¿›è¡Œæ’åºï¼Œä½¿å…·æœ‰ä¼˜å…ˆç„¦è·å’Œæ›´å¤šå¯¹åº”å…³ç³»çš„å›¾åƒæˆä¸ºå‡ºç°åœ¨åˆ—è¡¨çš„å‰é¢</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span>
   <span class="n">image_infos</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">image_infos</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
   <span class="p">[](</span><span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="n">image_info1</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="n">image_info2</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">image_info1</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">image_info2</span><span class="p">.</span><span class="n">prior_focal_length</span><span class="p">)</span>
         <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>

      <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="o">!</span><span class="n">image_info1</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">&amp;&amp;</span> <span class="n">image_info2</span><span class="p">.</span><span class="n">prior_focal_length</span><span class="p">)</span>
         <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

      <span class="k">else</span>
         <span class="k">return</span> <span class="n">image_info1</span><span class="p">.</span><span class="n">num_correspondences</span> <span class="o">&gt;</span> <span class="n">image_info2</span><span class="p">.</span><span class="n">num_correspondences</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
<li><p>æŒ‰æ’åºé¡ºåºæå–å›¾åƒæ ‡è¯†ç¬¦ï¼ˆidï¼‰</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="nl">image_info</span> <span class="p">:</span> <span class="n">image_infos</span><span class="p">)</span>
   <span class="n">image_ids</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">image_info</span><span class="p">.</span><span class="n">image_id</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="findsecondinitialimage">
<h3>FindSecondInitialImage<a class="headerlink" href="#findsecondinitialimage" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<dl class="cpp function">
<dt id="_CPPv4NK17IncrementalMapper22FindSecondInitialImageERK7OptionsK7image_t">
<span id="_CPPv3NK17IncrementalMapper22FindSecondInitialImageERK7OptionsK7image_t"></span><span id="_CPPv2NK17IncrementalMapper22FindSecondInitialImageERK7OptionsK7image_t"></span><span id="IncrementalMapper::FindSecondInitialImage__OptionsCR.image_tCC"></span>std::vector&lt;image_t&gt; <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">FindSecondInitialImage</code><span class="sig-paren">(</span><em class="property">const</em> <a class="reference internal" href="#_CPPv4N17IncrementalMapper7OptionsE" title="IncrementalMapper::Options">Options</a> &amp;<em>options</em>, <em class="property">const</em> image_t <em>image_id1</em><span class="sig-paren">)</span> <em class="property">const</em>;<a class="headerlink" href="#_CPPv4NK17IncrementalMapper22FindSecondInitialImageERK7OptionsK7image_t" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">FindSecondInitialImage</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">Options</span><span class="o">&amp;</span> <span class="n">options</span><span class="p">,</span> <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id1</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">CorrespondenceGraph</span><span class="o">&amp;</span> <span class="n">correspondence_graph</span> <span class="o">=</span>
      <span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">CorrespondenceGraph</span><span class="p">();</span>

  <span class="c1">// æ”¶é›†è¿æ¥åˆ°ç¬¬ä¸€ä¸ªç§å­å›¾åƒä¸”ä¹‹å‰æœªåœ¨å…¶ä»–é‡å»ºä¸­æ³¨å†Œçš„å›¾åƒ</span>
  <span class="k">const</span> <span class="k">class</span> <span class="nc">Image</span><span class="o">&amp;</span> <span class="n">image1</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id1</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="n">point2D_t</span><span class="o">&gt;</span> <span class="n">num_correspondences</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">point2D_t</span> <span class="n">point2D_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">point2D_idx</span> <span class="o">&lt;</span> <span class="n">image1</span><span class="p">.</span><span class="n">NumPoints2D</span><span class="p">();</span>
       <span class="o">++</span><span class="n">point2D_idx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">corr</span> <span class="p">:</span>
         <span class="n">correspondence_graph</span><span class="p">.</span><span class="n">FindCorrespondences</span><span class="p">(</span><span class="n">image_id1</span><span class="p">,</span> <span class="n">point2D_idx</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">num_registrations_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">image_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span>
          <span class="n">num_registrations_</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">image_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">num_correspondences</span><span class="p">[</span><span class="n">corr</span><span class="p">.</span><span class="n">image_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// ä¿ç•™å…ƒæ•°æ®ï¼ˆmeta-dataï¼‰ä»¥å¯¹å›¾åƒè¿›è¡Œæ’åçš„ç»“æ„</span>
  <span class="k">struct</span> <span class="n">ImageInfo</span> <span class="p">{</span>
    <span class="n">image_t</span> <span class="n">image_id</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">prior_focal_length</span><span class="p">;</span>
    <span class="n">point2D_t</span> <span class="n">num_correspondences</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="k">const</span> <span class="kt">size_t</span> <span class="n">init_min_num_inliers</span> <span class="o">=</span>
      <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">init_min_num_inliers</span><span class="p">);</span>

  <span class="c1">// ä»¥ç´§å‡‘çš„å½¢å¼ç»„åˆå›¾åƒä¿¡æ¯ä»¥è¿›è¡Œåˆ†ç±»</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ImageInfo</span><span class="o">&gt;</span> <span class="n">image_infos</span><span class="p">;</span>
  <span class="n">image_infos</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">NumImages</span><span class="p">());</span>

  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="nl">elem</span> <span class="p">:</span> <span class="n">num_correspondences</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// å¦‚æœç‚¹çš„æ•°é‡å¤§äºæœ€å°å†…ç‚¹æ•°</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">second</span> <span class="o">&gt;=</span> <span class="n">init_min_num_inliers</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="k">class</span> <span class="nc">Image</span><span class="o">&amp;</span> <span class="n">image</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
      <span class="k">const</span> <span class="k">class</span> <span class="nc">Camera</span><span class="o">&amp;</span> <span class="n">camera</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">CameraId</span><span class="p">());</span>
      <span class="n">ImageInfo</span> <span class="n">image_info</span><span class="p">;</span>
      <span class="n">image_info</span><span class="p">.</span><span class="n">image_id</span> <span class="o">=</span> <span class="n">elem</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
      <span class="n">image_info</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">HasPriorFocalLength</span><span class="p">();</span>
      <span class="n">image_info</span><span class="p">.</span><span class="n">num_correspondences</span> <span class="o">=</span> <span class="n">elem</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
      <span class="n">image_infos</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">image_info</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// å¯¹å›¾åƒè¿›è¡Œæ’åºï¼Œä½¿å…·æœ‰ä¼˜å…ˆç„¦è·å’Œæ›´å¤šå¯¹åº”å…³ç³»çš„å›¾åƒæˆä¸ºé¦–é€‰ï¼Œå³å®ƒä»¬å‡ºç°åœ¨åˆ—è¡¨çš„å‰é¢</span>
  <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span>
      <span class="n">image_infos</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">image_infos</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
      <span class="p">[](</span><span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="n">image_info1</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="n">image_info2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_info1</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">image_info2</span><span class="p">.</span><span class="n">prior_focal_length</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">image_info1</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">&amp;&amp;</span>
                   <span class="n">image_info2</span><span class="p">.</span><span class="n">prior_focal_length</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">image_info1</span><span class="p">.</span><span class="n">num_correspondences</span> <span class="o">&gt;</span>
                 <span class="n">image_info2</span><span class="p">.</span><span class="n">num_correspondences</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>

  <span class="c1">// æŒ‰æ’åºé¡ºåºæå–å›¾åƒæ ‡è¯†ç¬¦</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">image_ids</span><span class="p">;</span>
  <span class="n">image_ids</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">image_infos</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="nl">image_info</span> <span class="p">:</span> <span class="n">image_infos</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">image_ids</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">image_info</span><span class="p">.</span><span class="n">image_id</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">image_ids</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">æ³¨è§£</p>
<ol class="arabic">
<li><p>å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ç”¨äºå­˜å‚¨å›¾åƒçš„idã€æ˜¯å¦å…·æœ‰å…ˆéªŒç„¦è·ã€å¯¹åº”å…³ç³»æ•°</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">ImageInfo</span> <span class="p">{</span>
   <span class="n">image_t</span> <span class="n">image_id</span><span class="p">;</span>
   <span class="kt">bool</span> <span class="n">prior_focal_length</span><span class="p">;</span>
   <span class="n">image_t</span> <span class="n">num_correspondences</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>å¾—åˆ°å†…å­˜ç¼“å­˜ä¸­çš„å…³ç³»å›¾</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">CorrespondenceGraph</span><span class="o">&amp;</span> <span class="n">correspondence_graph</span> <span class="o">=</span> <span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">CorrespondenceGraph</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>éå†å›¾1ä¸­çš„æ¯ä¸€ä¸ªç‰¹å¾ç‚¹ï¼Œæ¯ä¸ªç‰¹å¾ç‚¹éƒ½å¯¹åº”è®¸å¤šçš„å›¾ï¼Œå¦‚æœå¯¹åº”çš„å›¾æ²¡æœ‰è¢«æ³¨å†Œåˆ°å…¶ä»–é‡å»ºä¸­ï¼Œåˆ™å°†å›¾çš„idä½œä¸º <code class="docutils literal notranslate"><span class="pre">num_correspondences</span></code> çš„ä¸‹æ ‡+1ï¼Œè®°å½•è¯¥å›¾ä¸å›¾1çš„å…³è”æ€§</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="k">class</span> <span class="nc">Image</span><span class="o">&amp;</span> <span class="n">image1</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id1</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="n">point2D_t</span><span class="o">&gt;</span> <span class="n">num_correspondences</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="n">point2D_t</span> <span class="n">point2D_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">point2D_idx</span> <span class="o">&lt;</span> <span class="n">image1</span><span class="p">.</span><span class="n">NumPoints2D</span><span class="p">();</span>
    <span class="o">++</span><span class="n">point2D_idx</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">corr</span> <span class="p">:</span>
      <span class="n">correspondence_graph</span><span class="p">.</span><span class="n">FindCorrespondences</span><span class="p">(</span><span class="n">image_id1</span><span class="p">,</span> <span class="n">point2D_idx</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">num_registrations_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">image_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span>
       <span class="n">num_registrations_</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">image_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">num_correspondences</span><span class="p">[</span><span class="n">corr</span><span class="p">.</span><span class="n">image_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>éå†ä¸å›¾1æœ‰å…³è”çš„æ‰€æœ‰çš„å›¾ï¼Œå¦‚æœå›¾çš„ç‰¹å¾ç‚¹æ•°é‡å¤§äºå†…ç‚¹é˜ˆå€¼ï¼Œåˆ™å°†å…¶åŠ å…¥åˆ° <code class="docutils literal notranslate"><span class="pre">image_infos</span></code> ä¸­</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ImageInfo</span><span class="o">&gt;</span> <span class="n">image_infos</span><span class="p">;</span>
<span class="n">image_infos</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">NumImages</span><span class="p">());</span>
<span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="nl">elem</span> <span class="p">:</span> <span class="n">num_correspondences</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">second</span> <span class="o">&gt;=</span> <span class="n">init_min_num_inliers</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="k">class</span> <span class="nc">Image</span><span class="o">&amp;</span> <span class="n">image</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
      <span class="k">const</span> <span class="k">class</span> <span class="nc">Camera</span><span class="o">&amp;</span> <span class="n">camera</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">CameraId</span><span class="p">());</span>
      <span class="n">ImageInfo</span> <span class="n">image_info</span><span class="p">;</span>
      <span class="n">image_info</span><span class="p">.</span><span class="n">image_id</span> <span class="o">=</span> <span class="n">elem</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
      <span class="n">image_info</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">HasPriorFocalLength</span><span class="p">();</span>
      <span class="n">image_info</span><span class="p">.</span><span class="n">num_correspondences</span> <span class="o">=</span> <span class="n">elem</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
      <span class="n">image_infos</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">image_info</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>å¯¹ <code class="docutils literal notranslate"><span class="pre">image_infos</span></code> ä¸­çš„å›¾ç‰‡è¿›è¡Œæ’åºï¼Œä½¿å…·æœ‰ä¼˜å…ˆç„¦è·å’Œæ›´å¤šå¯¹åº”å…³ç³»çš„å›¾åƒæˆä¸ºå‡ºç°åœ¨åˆ—è¡¨çš„å‰é¢</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span>
   <span class="n">image_infos</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">image_infos</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
   <span class="p">[](</span><span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="n">image_info1</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="n">image_info2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">image_info1</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">image_info2</span><span class="p">.</span><span class="n">prior_focal_length</span><span class="p">)</span>
         <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>

      <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="o">!</span><span class="n">image_info1</span><span class="p">.</span><span class="n">prior_focal_length</span> <span class="o">&amp;&amp;</span> <span class="n">image_info2</span><span class="p">.</span><span class="n">prior_focal_length</span><span class="p">)</span>
         <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">else</span>
       <span class="k">return</span> <span class="n">image_info1</span><span class="p">.</span><span class="n">num_correspondences</span> <span class="o">&gt;</span> <span class="n">image_info2</span><span class="p">.</span><span class="n">num_correspondences</span><span class="p">;</span>
   <span class="p">});</span>
</pre></div>
</div>
</li>
<li><p>æŒ‰æ’åºé¡ºåºæå–å›¾åƒæ ‡è¯†ç¬¦ï¼ˆidï¼‰</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">ImageInfo</span><span class="o">&amp;</span> <span class="nl">image_info</span> <span class="p">:</span> <span class="n">image_infos</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">image_ids</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">image_info</span><span class="p">.</span><span class="n">image_id</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="findnextimages">
<h3>FindNextImages<a class="headerlink" href="#findnextimages" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>æŸ¥æ‰¾æœ€ä½³çš„ä¸‹ä¸€ç»„å›¾åƒä»¥æ³¨å†Œåˆ°å¢é‡é‡å»ºã€‚</p>
<p>å›¾åƒåº”ä¼ é€’åˆ° <code class="docutils literal notranslate"><span class="pre">RegisterNextImag</span></code>ã€‚ æ­¤å‡½æ•°ä¼šè‡ªåŠ¨å¿½ç•¥æœªæ³¨å†Œ <code class="docutils literal notranslate"><span class="pre">max_reg_trial</span></code> çš„å›¾åƒã€‚</p>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper14FindNextImagesERK7Options">
<span id="_CPPv3N17IncrementalMapper14FindNextImagesERK7Options"></span><span id="_CPPv2N17IncrementalMapper14FindNextImagesERK7Options"></span><span id="IncrementalMapper::FindNextImages__OptionsCR"></span>std::vector&lt;image_t&gt; <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">FindNextImages</code><span class="sig-paren">(</span><em class="property">const</em> <a class="reference internal" href="#_CPPv4N17IncrementalMapper7OptionsE" title="IncrementalMapper::Options">Options</a> &amp;<em>options</em><span class="sig-paren">)</span>;<a class="headerlink" href="#_CPPv4N17IncrementalMapper14FindNextImagesERK7Options" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">FindNextImages</span><span class="p">(</span><span class="k">const</span> <span class="n">Options</span><span class="o">&amp;</span> <span class="n">options</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>
   <span class="n">CHECK</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Check</span><span class="p">());</span>


   <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">(</span><span class="k">const</span> <span class="n">Image</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">rank_image_func</span><span class="p">;</span>

   <span class="c1">// æ ¹æ®methodå†³å®šé€‰æ‹©ä¸‹ä¸€å¼ å›¾åƒçš„å‡½æ•°</span>
   <span class="k">switch</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">image_selection_method</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">case</span> <span class="n">Options</span><span class="o">::</span><span class="n">ImageSelectionMethod</span><span class="o">::</span><span class="nl">MAX_VISIBLE_POINTS_NUM</span><span class="p">:</span>
       <span class="n">rank_image_func</span> <span class="o">=</span> <span class="n">RankNextImageMaxVisiblePointsNum</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Options</span><span class="o">::</span><span class="n">ImageSelectionMethod</span><span class="o">::</span><span class="nl">MAX_VISIBLE_POINTS_RATIO</span><span class="p">:</span>
       <span class="n">rank_image_func</span> <span class="o">=</span> <span class="n">RankNextImageMaxVisiblePointsRatio</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Options</span><span class="o">::</span><span class="n">ImageSelectionMethod</span><span class="o">::</span><span class="nl">MIN_UNCERTAINTY</span><span class="p">:</span>
       <span class="n">rank_image_func</span> <span class="o">=</span> <span class="n">RankNextImageMinUncertainty</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;&gt;</span> <span class="n">image_ranks</span><span class="p">;</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;&gt;</span> <span class="n">other_image_ranks</span><span class="p">;</span>

   <span class="c1">// é™„åŠ ä¹‹å‰æ²¡æœ‰å¤±è´¥æ³¨å†Œçš„å›¾åƒ</span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">image</span> <span class="p">:</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Images</span><span class="p">())</span> <span class="p">{</span>
     <span class="c1">// è·³è¿‡å·²æ³¨å†Œçš„å›¾åƒ</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">IsRegistered</span><span class="p">())</span> <span class="p">{</span>
       <span class="k">continue</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="c1">// ä»…è€ƒè™‘å…·æœ‰è¶³å¤Ÿæ•°é‡çš„å¯è§ç‚¹çš„å›¾åƒ</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">NumVisiblePoints3D</span><span class="p">()</span> <span class="o">&lt;</span>
         <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">abs_pose_min_num_inliers</span><span class="p">))</span> <span class="p">{</span>
       <span class="k">continue</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="c1">// åªå°è¯•æ³¨å†Œæœ€å¤§æ¬¡æ•°</span>
     <span class="k">const</span> <span class="kt">size_t</span> <span class="n">num_reg_trials</span> <span class="o">=</span> <span class="n">num_reg_trials_</span><span class="p">[</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">];</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">num_reg_trials</span> <span class="o">&gt;=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">max_reg_trials</span><span class="p">))</span> <span class="p">{</span>
       <span class="k">continue</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="c1">// å¦‚æœå›¾åƒå·²è¢«è¿‡æ»¤æˆ–æ³¨å†Œå¤±è´¥ï¼Œå°†å…¶æ”¾ç½®åœ¨ç¬¬äºŒä¸ªå­˜å‚¨æ¡¶ä¸­ï¼Œå¹¶ä¼˜å…ˆä½¿ç”¨ä¹‹å‰æœªå°è¯•è¿‡çš„å›¾åƒã€‚</span>
     <span class="k">const</span> <span class="kt">float</span> <span class="n">rank</span> <span class="o">=</span> <span class="n">rank_image_func</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">second</span><span class="p">);</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">filtered_images_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">num_reg_trials</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">image_ranks</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">rank</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
       <span class="n">other_image_ranks</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">rank</span><span class="p">);</span>
     <span class="p">}</span>
   <span class="p">}</span>

   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">ranked_images_ids</span><span class="p">;</span>
   <span class="n">SortAndAppendNextImages</span><span class="p">(</span><span class="n">image_ranks</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ranked_images_ids</span><span class="p">);</span>
   <span class="n">SortAndAppendNextImages</span><span class="p">(</span><span class="n">other_image_ranks</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ranked_images_ids</span><span class="p">);</span>

   <span class="k">return</span> <span class="n">ranked_images_ids</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">æ³¨è§£</p>
<ol class="arabic">
<li><p>æ³¨æ„ <code class="docutils literal notranslate"><span class="pre">std::function&lt;float(const</span> <span class="pre">Image&amp;)&gt;</span> <span class="pre">rank_image_func</span></code> å®é™…ä¸Šç±»ä¼¼ä¸€ä¸ªæŒ‡é’ˆå‡½æ•°ï¼Œä»£ç ä¸­è®¾ç½®äº†ä¸‰ç§ä¸åŒçš„æ–¹æ³•ï¼š</p>
<blockquote>
<div><p>1ï¼‰ æ ¹æ®å¯è§ç‚¹æ•°é‡</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="nf">RankNextImageMaxVisiblePointsNum</span><span class="p">(</span><span class="k">const</span> <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">)</span>
   <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">NumVisiblePoints3D</span><span class="p">());</span>
</pre></div>
</div>
</div></blockquote>
<p>2ï¼‰ æ ¹æ®å¯è§ç‚¹çš„æ¯”ç‡</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="nf">RankNextImageMaxVisiblePointsRatio</span><span class="p">(</span><span class="k">const</span> <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">NumVisiblePoints3D</span><span class="p">())</span> <span class="o">/</span>
         <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">NumObservations</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>3ï¼‰ æ ¹æ®å¾—åˆ†é‡‘å­—å¡”</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="nf">RankNextImageMinUncertainty</span><span class="p">(</span><span class="k">const</span> <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">Point3DVisibilityScore</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SortAndAppendNextImages</span></code> æ˜¯æ ¹æ®ä¸Šä¸€æ­¥å›¾åƒçš„å¾—åˆ†å¯¹å›¾åƒè¿›è¡Œæ’åºï¼Œå¹¶åŠ å…¥æ–°çš„å›¾åƒè¿›å»ã€‚</p></li>
</ol>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">SortAndAppendNextImages</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;&gt;</span> <span class="n">image_ranks</span><span class="p">,</span>
              <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;*</span> <span class="n">sorted_images_ids</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span><span class="n">image_ranks</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">image_ranks</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
            <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;&amp;</span> <span class="n">image1</span><span class="p">,</span>
               <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;&amp;</span> <span class="n">image2</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="n">image1</span><span class="p">.</span><span class="n">second</span> <span class="o">&gt;</span> <span class="n">image2</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="p">});</span>

   <span class="n">sorted_images_ids</span><span class="o">-&gt;</span><span class="n">reserve</span><span class="p">(</span><span class="n">sorted_images_ids</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">image_ranks</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">image</span> <span class="p">:</span> <span class="n">image_ranks</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">sorted_images_ids</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="n">image_ranks</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="findlocalbundle">
<h3>FindLocalBundle<a class="headerlink" href="#findlocalbundle" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>åœ¨é‡å»ºä¸­æ‰¾åˆ°ç»™å®šå›¾åƒçš„å±€éƒ¨bundleã€‚</p>
<div class="admonition note">
<p class="admonition-title">æ³¨è§£</p>
<p>å±€éƒ¨bundleå®šä¹‰ä¸ºä¸ç»™å®šå›¾åƒçš„è¿æ¥æœ€å¤šçš„å›¾åƒï¼Œå³æœ€å¤§å…±äº«3Dç‚¹çš„æ•°é‡ã€‚</p>
</div>
<dl class="cpp function">
<dt id="_CPPv4NK17IncrementalMapper15FindLocalBundleERK7OptionsK7image_t">
<span id="_CPPv3NK17IncrementalMapper15FindLocalBundleERK7OptionsK7image_t"></span><span id="_CPPv2NK17IncrementalMapper15FindLocalBundleERK7OptionsK7image_t"></span><span id="IncrementalMapper::FindLocalBundle__OptionsCR.image_tCC"></span>std::vector&lt;image_t&gt; <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">FindLocalBundle</code><span class="sig-paren">(</span><em class="property">const</em> <a class="reference internal" href="#_CPPv4N17IncrementalMapper7OptionsE" title="IncrementalMapper::Options">Options</a> &amp;<em>options</em>, <em class="property">const</em> image_t <em>image_id</em><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv4NK17IncrementalMapper15FindLocalBundleERK7OptionsK7image_t" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">FindLocalBundle</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">Options</span><span class="o">&amp;</span> <span class="n">options</span><span class="p">,</span> <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
   <span class="n">CHECK</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Check</span><span class="p">());</span>

   <span class="k">const</span> <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id</span><span class="p">);</span>
   <span class="n">CHECK</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">IsRegistered</span><span class="p">());</span>

   <span class="c1">// æå–ä¸æŸ¥è¯¢çš„å›¾ç‰‡è‡³å°‘æœ‰ä¸€ä¸ªå…±åŒçš„3Dç‚¹çš„æ‰€æœ‰å›¾ç‰‡ï¼ŒåŒæ—¶è®¡ç®—å…¬å…±3Dç‚¹çš„æ•°é‡</span>

   <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">shared_observations</span><span class="p">;</span>

   <span class="n">std</span><span class="o">::</span><span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">point3D_t</span><span class="o">&gt;</span> <span class="n">point3D_ids</span><span class="p">;</span>
   <span class="n">point3D_ids</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">());</span>

   <span class="c1">// éå†å›¾åƒä¸­æ¯ä¸€ä¸ª2Dç‰¹å¾ç‚¹</span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">Point2D</span><span class="o">&amp;</span> <span class="nl">point2D</span> <span class="p">:</span> <span class="n">image</span><span class="p">.</span><span class="n">Points2D</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// å¦‚æœ2Dç‚¹æœ‰å¯¹åº”çš„3Dç‚¹</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">point2D</span><span class="p">.</span><span class="n">HasPoint3D</span><span class="p">())</span> <span class="p">{</span>
         <span class="c1">// æ’å…¥è¯¥3Dç‚¹çš„id</span>
         <span class="n">point3D_ids</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">point2D</span><span class="p">.</span><span class="n">Point3DId</span><span class="p">());</span>
         <span class="c1">// ä»é‡å»ºä¸­æ ¹æ®è¯¥idå¾—åˆ°å¯¹åº”çš„3Dç‚¹</span>
         <span class="k">const</span> <span class="n">Point3D</span><span class="o">&amp;</span> <span class="n">point3D</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Point3D</span><span class="p">(</span><span class="n">point2D</span><span class="p">.</span><span class="n">Point3DId</span><span class="p">());</span>
         <span class="c1">// éå†è¯¥3Dç‚¹çš„è½¨é“çš„æ‰€æœ‰å…ƒç´ </span>
         <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">TrackElement</span><span class="o">&amp;</span> <span class="nl">track_el</span> <span class="p">:</span> <span class="n">point3D</span><span class="p">.</span><span class="n">Track</span><span class="p">().</span><span class="n">Elements</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// å¦‚æœè½¨é“çš„å›¾åƒä¸è§‚æµ‹å›¾åƒä¸æ˜¯ä¸€ä¸ªå›¾åƒï¼Œåˆ™å°†å…¶åŠ å…¥åˆ°å…±äº«è§‚æµ‹åºåˆ—ä¸­</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">track_el</span><span class="p">.</span><span class="n">image_id</span> <span class="o">!=</span> <span class="n">image_id</span><span class="p">)</span> <span class="p">{</span>
               <span class="n">shared_observations</span><span class="p">[</span><span class="n">track_el</span><span class="p">.</span><span class="n">image_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="c1">// æ ¹æ®å…±äº«è§‚æµ‹çš„æ•°é‡å¯¹é‡å çš„å›¾åƒè¿›è¡Œæ’åº</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="kt">size_t</span><span class="o">&gt;&gt;</span> <span class="n">overlapping_images</span><span class="p">(</span>
      <span class="n">shared_observations</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">shared_observations</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
   <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span><span class="n">overlapping_images</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">overlapping_images</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
            <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="kt">size_t</span><span class="o">&gt;&amp;</span> <span class="n">image1</span><span class="p">,</span>
               <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">image_t</span><span class="p">,</span> <span class="kt">size_t</span><span class="o">&gt;&amp;</span> <span class="n">image2</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="n">image1</span><span class="p">.</span><span class="n">second</span> <span class="o">&gt;</span> <span class="n">image2</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="p">});</span>


   <span class="c1">// å±€éƒ¨bundleç”±ç»™å®šå›¾åƒåŠå…¶è¿æ¥æœ€ç´§å¯†çš„ç›¸é‚»å›¾åƒç»„æˆï¼Œå› æ­¤å‡å»1 ï¼ˆä¸ºä»€ä¹ˆ-1ï¼Ÿï¼‰</span>

   <span class="k">const</span> <span class="kt">size_t</span> <span class="n">num_images</span> <span class="o">=</span>
         <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">local_ba_num_images</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
   <span class="k">const</span> <span class="kt">size_t</span> <span class="n">num_eff_images</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">num_images</span><span class="p">,</span> <span class="n">overlapping_images</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

   <span class="c1">// æå–æœ€å¤šè¿æ¥çš„å›¾åƒï¼Œå¹¶ç¡®ä¿è¶³å¤Ÿçš„ä¸‰è§’å‰–åˆ†è§’åº¦</span>

   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">local_bundle_image_ids</span><span class="p">;</span>
   <span class="n">local_bundle_image_ids</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">num_eff_images</span><span class="p">);</span>

   <span class="c1">// å¦‚æœé‡å å›¾åƒçš„æ•°é‡ç­‰äºæœ¬åœ°bundleä¸­æ‰€éœ€å›¾åƒçš„æ•°é‡ï¼Œåˆ™åªéœ€å¤åˆ¶å›¾åƒæ ‡è¯†ç¬¦å³å¯</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">overlapping_images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">num_eff_images</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">overlapping_image</span> <span class="p">:</span> <span class="n">overlapping_images</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">local_bundle_image_ids</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">overlapping_image</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">local_bundle_image_ids</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">// åœ¨ä¸‹é¢çš„è¿­ä»£ä¸­ï¼Œä»é‡å æœ€å¤šçš„å›¾åƒå¼€å§‹ï¼Œå¹¶æ£€æŸ¥å…¶æ˜¯å¦å…·æœ‰è¶³å¤Ÿçš„ä¸‰è§’å‰–åˆ†è§’åº¦ã€‚</span>
   <span class="c1">// å¦‚æœæ²¡æœ‰ä¸€ä¸ªé‡å çš„å›¾åƒå…·æœ‰è¶³å¤Ÿçš„ä¸‰è§’å‰–åˆ†è§’åº¦ï¼Œåˆ™æ”¾å®½ä¸‰è§’å‰–åˆ†é˜ˆå€¼ï¼Œç„¶åä»æœ€é‡å çš„å›¾åƒé‡æ–°å¼€å§‹ã€‚</span>
   <span class="c1">// æœ€åå¦‚æœä»ç„¶æ‰¾ä¸åˆ°è¶³å¤Ÿçš„å›¾åƒï¼Œåˆ™ä»…ä½¿ç”¨é‡å åº¦æœ€é«˜çš„å›¾åƒ</span>

   <span class="k">const</span> <span class="kt">double</span> <span class="n">min_tri_angle_rad</span> <span class="o">=</span> <span class="n">DegToRad</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">local_ba_min_tri_angle</span><span class="p">);</span>

   <span class="c1">// é€‰æ‹©é˜ˆå€¼ï¼ˆæœ€å°ä¸‰è§’å‰–åˆ†ï¼Œå…±äº«è§‚æµ‹å€¼çš„æœ€å°æ•°é‡ï¼‰è¢«ä¾æ¬¡æ”¾å®½</span>
   <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">8</span><span class="o">&gt;</span> <span class="n">selection_thresholds</span> <span class="o">=</span> <span class="p">{{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">min_tri_angle_rad</span> <span class="o">/</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">()),</span>
      <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">min_tri_angle_rad</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">()),</span>
      <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">min_tri_angle_rad</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">()),</span>
      <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">min_tri_angle_rad</span> <span class="o">/</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">()),</span>
      <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">min_tri_angle_rad</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">()),</span>
      <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">min_tri_angle_rad</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">()),</span>
      <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">min_tri_angle_rad</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">()),</span>
      <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">min_tri_angle_rad</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">()),</span>
   <span class="p">}};</span>

   <span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span> <span class="n">proj_center</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ProjectionCenter</span><span class="p">();</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="o">&gt;</span> <span class="n">shared_points3D</span><span class="p">;</span>
   <span class="n">shared_points3D</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">NumPoints3D</span><span class="p">());</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">tri_angles</span><span class="p">(</span><span class="n">overlapping_images</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">);</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">used_overlapping_images</span><span class="p">(</span><span class="n">overlapping_images</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="nb">false</span><span class="p">);</span>

   <span class="c1">// éå†æ¯ä¸ªä¸‰è§’å‰–åˆ†é˜ˆå€¼</span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">selection_threshold</span> <span class="p">:</span> <span class="n">selection_thresholds</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// éå†æ¯ä¸ªé‡å çš„å›¾åƒ</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">overlapping_image_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
         <span class="n">overlapping_image_idx</span> <span class="o">&lt;</span> <span class="n">overlapping_images</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
         <span class="o">++</span><span class="n">overlapping_image_idx</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// æ£€æŸ¥å›¾åƒæ˜¯å¦æœ‰è¶³å¤Ÿçš„é‡å ã€‚ ç”±äºå›¾åƒæ˜¯æ ¹æ®é‡å è¿›è¡Œæ’åºçš„ï¼Œå› æ­¤åœ¨é‡å ä¸å¤Ÿåå¯ä»¥è·³è¿‡å…¶ä½™å›¾åƒã€‚</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">overlapping_images</span><span class="p">[</span><span class="n">overlapping_image_idx</span><span class="p">].</span><span class="n">second</span> <span class="o">&lt;</span>
            <span class="n">selection_threshold</span><span class="p">.</span><span class="n">second</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>

         <span class="c1">// æ£€æŸ¥å›¾åƒæ˜¯å¦å·²ç»åœ¨æœ¬åœ°bundleä¸­</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">used_overlapping_images</span><span class="p">[</span><span class="n">overlapping_image_idx</span><span class="p">])</span>
           <span class="k">continue</span><span class="p">;</span>

         <span class="c1">// å¾—åˆ°é‡å çš„å›¾åƒ</span>
         <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">overlapping_image</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span>
             <span class="n">overlapping_images</span><span class="p">[</span><span class="n">overlapping_image_idx</span><span class="p">].</span><span class="n">first</span><span class="p">);</span>

         <span class="c1">// å¾—åˆ°é‡å å›¾åƒçš„æŠ•å½±ä¸­å¿ƒ</span>
         <span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span> <span class="n">overlapping_proj_center</span> <span class="o">=</span>
             <span class="n">overlapping_image</span><span class="p">.</span><span class="n">ProjectionCenter</span><span class="p">();</span>

         <span class="c1">// åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œè®¡ç®—ä¸‰è§’å‰–åˆ†è§’åº¦ã€‚ åœ¨ä»¥åçš„è¿­ä»£ä¸­ï¼Œé‡ç”¨å…ˆå‰è®¡ç®—çš„å€¼</span>
         <span class="kt">double</span><span class="o">&amp;</span> <span class="n">tri_angle</span> <span class="o">=</span> <span class="n">tri_angles</span><span class="p">[</span><span class="n">overlapping_image_idx</span><span class="p">];</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">tri_angle</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="p">{</span>
           <span class="c1">// æ”¶é›†è§‚å¯Ÿåˆ°çš„3Dç‚¹</span>
           <span class="n">shared_points3D</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
           <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">Point2D</span><span class="o">&amp;</span> <span class="nl">point2D</span> <span class="p">:</span> <span class="n">image</span><span class="p">.</span><span class="n">Points2D</span><span class="p">())</span> <span class="p">{</span>
             <span class="k">if</span> <span class="p">(</span><span class="n">point2D</span><span class="p">.</span><span class="n">HasPoint3D</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">point3D_ids</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">point2D</span><span class="p">.</span><span class="n">Point3DId</span><span class="p">()))</span> <span class="p">{</span>
               <span class="n">shared_points3D</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
                   <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Point3D</span><span class="p">(</span><span class="n">point2D</span><span class="p">.</span><span class="n">Point3DId</span><span class="p">()).</span><span class="n">XYZ</span><span class="p">());</span>
               <span class="p">}</span>
            <span class="p">}</span>

           <span class="c1">// è®¡ç®—ä¸€å®šç™¾åˆ†æ¯”çš„ä¸‰è§’å‰–åˆ†è§’åº¦</span>
           <span class="k">const</span> <span class="kt">double</span> <span class="n">kTriangulationAnglePercentile</span> <span class="o">=</span> <span class="mi">75</span><span class="p">;</span>
           <span class="n">tri_angle</span> <span class="o">=</span> <span class="n">Percentile</span><span class="p">(</span>
               <span class="n">CalculateTriangulationAngles</span><span class="p">(</span><span class="n">proj_center</span><span class="p">,</span> <span class="n">overlapping_proj_center</span><span class="p">,</span>
                                            <span class="n">shared_points3D</span><span class="p">),</span>
               <span class="n">kTriangulationAnglePercentile</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="c1">// æ£€æŸ¥å›¾åƒæ˜¯å¦å…·æœ‰è¶³å¤Ÿçš„ä¸‰è§’å‰–åˆ†è§’åº¦</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">tri_angle</span> <span class="o">&gt;=</span> <span class="n">selection_threshold</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">local_bundle_image_ids</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">overlapping_image</span><span class="p">.</span><span class="n">ImageId</span><span class="p">());</span>
            <span class="n">used_overlapping_images</span><span class="p">[</span><span class="n">overlapping_image_idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="c1">// æ£€æŸ¥æ˜¯å¦å·²ç»æ”¶é›†äº†è¶³å¤Ÿçš„å›¾åƒ</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">local_bundle_image_ids</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">num_eff_images</span><span class="p">)</span>
               <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">}</span>

      <span class="c1">// æ£€æŸ¥æ˜¯å¦å·²ç»æ”¶é›†äº†è¶³å¤Ÿçš„å›¾åƒ</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">local_bundle_image_ids</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">num_eff_images</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="c1">// å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å…·æœ‰è¶³å¤Ÿä¸‰è§’å‰–åˆ†è§’çš„å›¾åƒï¼Œåªéœ€ç”¨æœ€é‡å çš„å›¾åƒå¡«å……å…¶ä½™å›¾åƒå³å¯</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">local_bundle_image_ids</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">num_eff_images</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">overlapping_image_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
         <span class="n">overlapping_image_idx</span> <span class="o">&lt;</span> <span class="n">overlapping_images</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
         <span class="o">++</span><span class="n">overlapping_image_idx</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// æ”¶é›†å›¾åƒï¼ˆå¦‚æœå°šæœªåœ¨å±€éƒ¨bundleä¸­ï¼‰</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">used_overlapping_images</span><span class="p">[</span><span class="n">overlapping_image_idx</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">local_bundle_image_ids</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
               <span class="n">overlapping_images</span><span class="p">[</span><span class="n">overlapping_image_idx</span><span class="p">].</span><span class="n">first</span><span class="p">);</span>
            <span class="n">used_overlapping_images</span><span class="p">[</span><span class="n">overlapping_image_idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

            <span class="c1">// æ£€æµ‹æ˜¯å¦å·²ç»æ”¶é›†äº†è¶³å¤Ÿçš„å›¾åƒ</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">local_bundle_image_ids</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">num_eff_images</span><span class="p">)</span>
               <span class="k">break</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="c1">// è¿”å›å±€éƒ¨bundleçš„å›¾åƒidåºåˆ—</span>
   <span class="k">return</span> <span class="n">local_bundle_image_ids</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">æ³¨è§£</p>
<p>è¯¥å‡½æ•°çš„è¦æ±‚æ˜¯åœ¨é‡å»ºä¸­æ‰¾åˆ°ç»™å®šå›¾åƒçš„å±€éƒ¨bundleã€‚</p>
<p>è¯¥å‡½æ•°çš„æ­¥éª¤ä¸ºï¼š</p>
<blockquote>
<div><p>éå†ç»™å®šå›¾åƒçš„æ‰€æœ‰2Dç‰¹å¾ç‚¹çš„3Dè½¨é“ï¼Œæ¯æ¡è½¨é“éƒ½ä¼šè®¡ç®—å…¶æ‰€æœ‰ç»è¿‡çš„å›¾åƒçš„åºå·ï¼Œæœ€ç»ˆæ‰€æœ‰ç‰¹å¾ç‚¹çš„3Dç‚¹çš„è½¨é“ç»è¿‡çš„å›¾åƒåœ¨æ¬¡æ•°ä¸Šä¼šè¿›è¡Œæ’åºï¼Œç§°ä¸º <code class="docutils literal notranslate"><span class="pre">overlapping_images</span></code> ï¼Œ
å¯¹è¯¥é‡å å›¾åƒçš„åºåˆ—è¿›è¡Œæ’åºï¼Œé€šè¿‡æ§åˆ¶ä¸‰è§’å‰–åˆ†çš„é˜ˆå€¼ï¼Œä»é‡å æœ€å¤šçš„å›¾åƒå¼€å§‹ï¼Œå¹¶æ£€æŸ¥å…¶æ˜¯å¦å…·æœ‰è¶³å¤Ÿçš„ä¸‰è§’å‰–åˆ†è§’åº¦ï¼Œç¬¦åˆè¦æ±‚çš„åŠ å…¥åˆ° <code class="docutils literal notranslate"><span class="pre">local_bundle_image_ids</span></code> ä¸­ï¼Œæœ€åå¦‚æœä»ç„¶æ‰¾ä¸åˆ°è¶³å¤Ÿçš„å›¾åƒï¼Œåˆ™ä»…ä½¿ç”¨é‡å åº¦æœ€é«˜çš„å›¾åƒã€‚
æœ€ç»ˆè¿”å›å±€éƒ¨bundleçš„å›¾åƒidåºåˆ—ã€‚</p>
</div></blockquote>
</div>
</div>
<div class="section" id="estimateinitialtwoviewgeometry">
<h3>EstimateInitialTwoViewGeometry<a class="headerlink" href="#estimateinitialtwoviewgeometry" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>ä¼°è®¡åˆå§‹ç§å­å›¾åƒå¯¹çš„ä¸¤è§†å›¾å‡ ä½•</p>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper30EstimateInitialTwoViewGeometryERK7OptionsK7image_tK7image_t">
<span id="_CPPv3N17IncrementalMapper30EstimateInitialTwoViewGeometryERK7OptionsK7image_tK7image_t"></span><span id="_CPPv2N17IncrementalMapper30EstimateInitialTwoViewGeometryERK7OptionsK7image_tK7image_t"></span><span id="IncrementalMapper::EstimateInitialTwoViewGeometry__OptionsCR.image_tC.image_tC"></span>bool <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">EstimateInitialTwoViewGeometry</code><span class="sig-paren">(</span><em class="property">const</em> <a class="reference internal" href="#_CPPv4N17IncrementalMapper7OptionsE" title="IncrementalMapper::Options">Options</a> &amp;<em>options</em>, <em class="property">const</em> image_t <em>image_id1</em>, <em class="property">const</em> image_t <em>image_id2</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper30EstimateInitialTwoViewGeometryERK7OptionsK7image_tK7image_t" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">EstimateInitialTwoViewGeometry</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">Options</span><span class="o">&amp;</span> <span class="n">options</span><span class="p">,</span> <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id1</span><span class="p">,</span> <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id2</span><span class="p">)</span> <span class="p">{</span>

   <span class="c1">// æ ¹æ®å›¾åƒidå¾—åˆ°å›¾åƒå¯¹</span>
   <span class="k">const</span> <span class="n">image_pair_t</span> <span class="n">image_pair_id</span> <span class="o">=</span>
      <span class="n">Database</span><span class="o">::</span><span class="n">ImagePairToPairId</span><span class="p">(</span><span class="n">image_id1</span><span class="p">,</span> <span class="n">image_id2</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">prev_init_image_pair_id_</span> <span class="o">==</span> <span class="n">image_pair_id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">// å¾—åˆ°å›¾åƒã€å¯¹åº”ç›¸æœºã€å…³è”å›¾ã€åŒ¹é…å…³ç³»</span>
   <span class="k">const</span> <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image1</span> <span class="o">=</span> <span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id1</span><span class="p">);</span>
   <span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera1</span> <span class="o">=</span> <span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image1</span><span class="p">.</span><span class="n">CameraId</span><span class="p">());</span>

   <span class="k">const</span> <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image2</span> <span class="o">=</span> <span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id2</span><span class="p">);</span>
   <span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera2</span> <span class="o">=</span> <span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image2</span><span class="p">.</span><span class="n">CameraId</span><span class="p">());</span>

   <span class="k">const</span> <span class="n">CorrespondenceGraph</span><span class="o">&amp;</span> <span class="n">correspondence_graph</span> <span class="o">=</span>
      <span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">CorrespondenceGraph</span><span class="p">();</span>
   <span class="k">const</span> <span class="n">FeatureMatches</span> <span class="n">matches</span> <span class="o">=</span>
      <span class="n">correspondence_graph</span><span class="p">.</span><span class="n">FindCorrespondencesBetweenImages</span><span class="p">(</span><span class="n">image_id1</span><span class="p">,</span>
                                                            <span class="n">image_id2</span><span class="p">);</span>

   <span class="c1">// å°†å›¾1ä¸­çš„ç‰¹å¾ç‚¹åŠ å…¥points1</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">&gt;</span> <span class="n">points1</span><span class="p">;</span>
   <span class="n">points1</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">image1</span><span class="p">.</span><span class="n">NumPoints2D</span><span class="p">());</span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">point</span> <span class="p">:</span> <span class="n">image1</span><span class="p">.</span><span class="n">Points2D</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">points1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">XY</span><span class="p">());</span>
   <span class="p">}</span>

   <span class="c1">// å°†å›¾2ä¸­çš„ç‰¹å¾ç‚¹åŠ å…¥points2</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">&gt;</span> <span class="n">points2</span><span class="p">;</span>
   <span class="n">points2</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">image2</span><span class="p">.</span><span class="n">NumPoints2D</span><span class="p">());</span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">point</span> <span class="p">:</span> <span class="n">image2</span><span class="p">.</span><span class="n">Points2D</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">points2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">point</span><span class="p">.</span><span class="n">XY</span><span class="p">());</span>
   <span class="p">}</span>

   <span class="c1">// ä¸¤è§†å›¾å‡ ä½•ä¼°è®¡</span>
   <span class="n">TwoViewGeometry</span> <span class="n">two_view_geometry</span><span class="p">;</span>
   <span class="n">TwoViewGeometry</span><span class="o">::</span><span class="n">Options</span> <span class="n">two_view_geometry_options</span><span class="p">;</span>
   <span class="n">two_view_geometry_options</span><span class="p">.</span><span class="n">ransac_options</span><span class="p">.</span><span class="n">min_num_trials</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
   <span class="n">two_view_geometry_options</span><span class="p">.</span><span class="n">ransac_options</span><span class="p">.</span><span class="n">max_error</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">init_max_error</span><span class="p">;</span>
   <span class="n">two_view_geometry</span><span class="p">.</span><span class="n">EstimateCalibrated</span><span class="p">(</span><span class="n">camera1</span><span class="p">,</span> <span class="n">points1</span><span class="p">,</span> <span class="n">camera2</span><span class="p">,</span> <span class="n">points2</span><span class="p">,</span>
                                       <span class="n">matches</span><span class="p">,</span> <span class="n">two_view_geometry_options</span><span class="p">);</span>

   <span class="c1">// ä¼°è®¡ä¸¤è§†å›¾ç›¸å¯¹ä½å§¿</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">two_view_geometry</span><span class="p">.</span><span class="n">EstimateRelativePose</span><span class="p">(</span><span class="n">camera1</span><span class="p">,</span> <span class="n">points1</span><span class="p">,</span> <span class="n">camera2</span><span class="p">,</span>
                                              <span class="n">points2</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">// å¦‚æœåŒ¹é…å†…ç‚¹æ•° &gt; æœ€å°åˆå§‹åŒ–å†…ç‚¹æ•° ä¸” zè½´ç§»åŠ¨ &lt; æœ€å¤§ä½ç§» ä¸” ä¸‰è§’å‰–åˆ†è§’ &gt; æœ€å°ä¸‰è§’å‰–åˆ†è§’ï¼Œåˆ™ä¼°è®¡æˆåŠŸ</span>
   <span class="k">if</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">two_view_geometry</span><span class="p">.</span><span class="n">inlier_matches</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">&gt;=</span>
       <span class="n">options</span><span class="p">.</span><span class="n">init_min_num_inliers</span> <span class="o">&amp;&amp;</span>
       <span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">two_view_geometry</span><span class="p">.</span><span class="n">tvec</span><span class="p">.</span><span class="n">z</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">options</span><span class="p">.</span><span class="n">init_max_forward_motion</span> <span class="o">&amp;&amp;</span>
       <span class="n">two_view_geometry</span><span class="p">.</span><span class="n">tri_angle</span> <span class="o">&gt;</span> <span class="n">DegToRad</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">init_min_tri_angle</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">prev_init_image_pair_id_</span> <span class="o">=</span> <span class="n">image_pair_id</span><span class="p">;</span>
         <span class="n">prev_init_two_view_geometry_</span> <span class="o">=</span> <span class="n">two_view_geometry</span><span class="p">;</span>
         <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="registerinitialimagepair">
<h3>RegisterInitialImagePair<a class="headerlink" href="#registerinitialimagepair" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>ä»ç§å­å›¾åƒå¯¹å¼€å§‹é‡å»º</p>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper24RegisterInitialImagePairERK7OptionsK7image_tK7image_t">
<span id="_CPPv3N17IncrementalMapper24RegisterInitialImagePairERK7OptionsK7image_tK7image_t"></span><span id="_CPPv2N17IncrementalMapper24RegisterInitialImagePairERK7OptionsK7image_tK7image_t"></span><span id="IncrementalMapper::RegisterInitialImagePair__OptionsCR.image_tC.image_tC"></span>bool <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">RegisterInitialImagePair</code><span class="sig-paren">(</span><em class="property">const</em> <a class="reference internal" href="#_CPPv4N17IncrementalMapper7OptionsE" title="IncrementalMapper::Options">Options</a> &amp;<em>options</em>, <em class="property">const</em> image_t <em>image_id1</em>, <em class="property">const</em> image_t <em>image_id2</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper24RegisterInitialImagePairERK7OptionsK7image_tK7image_t" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">RegisterInitialImagePair</span><span class="p">(</span><span class="k">const</span> <span class="n">Options</span><span class="o">&amp;</span> <span class="n">options</span><span class="p">,</span>
                                                 <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id1</span><span class="p">,</span>
                                                 <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id2</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>
   <span class="n">CHECK_EQ</span><span class="p">(</span><span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">NumRegImages</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>

   <span class="n">CHECK</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Check</span><span class="p">());</span>

   <span class="n">init_num_reg_trials_</span><span class="p">[</span><span class="n">image_id1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
   <span class="n">init_num_reg_trials_</span><span class="p">[</span><span class="n">image_id2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
   <span class="n">num_reg_trials_</span><span class="p">[</span><span class="n">image_id1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
   <span class="n">num_reg_trials_</span><span class="p">[</span><span class="n">image_id2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

   <span class="c1">// å¾—åˆ°å›¾åƒå¯¹</span>
   <span class="k">const</span> <span class="n">image_pair_t</span> <span class="n">pair_id</span> <span class="o">=</span>
         <span class="n">Database</span><span class="o">::</span><span class="n">ImagePairToPairId</span><span class="p">(</span><span class="n">image_id1</span><span class="p">,</span> <span class="n">image_id2</span><span class="p">);</span>
   <span class="n">init_image_pairs_</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pair_id</span><span class="p">);</span>

   <span class="c1">// å¾—åˆ°å›¾åƒå’Œå¯¹åº”ç›¸æœº</span>
   <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image1</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id1</span><span class="p">);</span>
   <span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera1</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image1</span><span class="p">.</span><span class="n">CameraId</span><span class="p">());</span>

   <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image2</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id2</span><span class="p">);</span>
   <span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera2</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image2</span><span class="p">.</span><span class="n">CameraId</span><span class="p">());</span>

   <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>
   <span class="c1">// ä¼°è®¡ä¸¤è§†å›¾å‡ ä½•</span>
   <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">EstimateInitialTwoViewGeometry</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">image_id1</span><span class="p">,</span> <span class="n">image_id2</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">// è®¾ç¬¬ä¸€ä¸ªå›¾åƒçš„æ—‹è½¬ä¸ºå•ä½çŸ©é˜µï¼Œä½ç§»ä¸ºé›¶å‘é‡</span>
   <span class="n">image1</span><span class="p">.</span><span class="n">Qvec</span><span class="p">()</span> <span class="o">=</span> <span class="n">ComposeIdentityQuaternion</span><span class="p">();</span>
   <span class="n">image1</span><span class="p">.</span><span class="n">Tvec</span><span class="p">()</span> <span class="o">=</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

   <span class="c1">// ç¬¬äºŒä¸ªå›¾åƒçš„Rå’Œtä¸ºä»ä¸¤è§†å›¾å‡ ä½•ä¸­åˆ†è§£å¾—åˆ°çš„ç›¸å¯¹æ—‹è½¬å’Œä½ç§»</span>
   <span class="n">image2</span><span class="p">.</span><span class="n">Qvec</span><span class="p">()</span> <span class="o">=</span> <span class="n">prev_init_two_view_geometry_</span><span class="p">.</span><span class="n">qvec</span><span class="p">;</span>
   <span class="n">image2</span><span class="p">.</span><span class="n">Tvec</span><span class="p">()</span> <span class="o">=</span> <span class="n">prev_init_two_view_geometry_</span><span class="p">.</span><span class="n">tvec</span><span class="p">;</span>

   <span class="c1">// å¾—åˆ°ä¸¤ä¸ªå›¾åƒçš„æŠ•å½±çŸ©é˜µå’ŒæŠ•å½±ä¸­å¿ƒ</span>
   <span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3x4d</span> <span class="n">proj_matrix1</span> <span class="o">=</span> <span class="n">image1</span><span class="p">.</span><span class="n">ProjectionMatrix</span><span class="p">();</span>
   <span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix3x4d</span> <span class="n">proj_matrix2</span> <span class="o">=</span> <span class="n">image2</span><span class="p">.</span><span class="n">ProjectionMatrix</span><span class="p">();</span>
   <span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span> <span class="n">proj_center1</span> <span class="o">=</span> <span class="n">image1</span><span class="p">.</span><span class="n">ProjectionCenter</span><span class="p">();</span>
   <span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span> <span class="n">proj_center2</span> <span class="o">=</span> <span class="n">image2</span><span class="p">.</span><span class="n">ProjectionCenter</span><span class="p">();</span>

   <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>
   <span class="c1">// æ›´æ–°é‡å»º</span>
   <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>

   <span class="c1">// é‡å»ºæ³¨å†Œä¸¤ä¸ªå›¾ç‰‡</span>
   <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">RegisterImage</span><span class="p">(</span><span class="n">image_id1</span><span class="p">);</span>
   <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">RegisterImage</span><span class="p">(</span><span class="n">image_id2</span><span class="p">);</span>
   <span class="n">RegisterImageEvent</span><span class="p">(</span><span class="n">image_id1</span><span class="p">);</span>
   <span class="n">RegisterImageEvent</span><span class="p">(</span><span class="n">image_id2</span><span class="p">);</span>

   <span class="c1">// ä»æ•°æ®åº“ä¸­å¾—åˆ°å…³è”å›¾å’Œç‰¹å¾åŒ¹é…</span>
   <span class="k">const</span> <span class="n">CorrespondenceGraph</span><span class="o">&amp;</span> <span class="n">correspondence_graph</span> <span class="o">=</span>
         <span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">CorrespondenceGraph</span><span class="p">();</span>
   <span class="k">const</span> <span class="n">FeatureMatches</span><span class="o">&amp;</span> <span class="n">corrs</span> <span class="o">=</span>
         <span class="n">correspondence_graph</span><span class="p">.</span><span class="n">FindCorrespondencesBetweenImages</span><span class="p">(</span><span class="n">image_id1</span><span class="p">,</span>
                                                            <span class="n">image_id2</span><span class="p">);</span>

   <span class="c1">// å¾—åˆ°æœ€å°ä¸‰è§’å‰–åˆ†è§’åº¦</span>
   <span class="k">const</span> <span class="kt">double</span> <span class="n">min_tri_angle_rad</span> <span class="o">=</span> <span class="n">DegToRad</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">init_min_tri_angle</span><span class="p">);</span>

   <span class="c1">// å°†3Dç‚¹åŠ å…¥åˆ°Trackä¸­</span>
   <span class="n">Track</span> <span class="n">track</span><span class="p">;</span>
   <span class="n">track</span><span class="p">.</span><span class="n">Reserve</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
   <span class="n">track</span><span class="p">.</span><span class="n">AddElement</span><span class="p">(</span><span class="n">TrackElement</span><span class="p">());</span>
   <span class="n">track</span><span class="p">.</span><span class="n">AddElement</span><span class="p">(</span><span class="n">TrackElement</span><span class="p">());</span>
   <span class="n">track</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">image_id</span> <span class="o">=</span> <span class="n">image_id1</span><span class="p">;</span>
   <span class="n">track</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">image_id</span> <span class="o">=</span> <span class="n">image_id2</span><span class="p">;</span>

   <span class="c1">// éå†æ‰€æœ‰çš„åŒ¹é…ç‚¹</span>
   <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">corr</span> <span class="p">:</span> <span class="n">corrs</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// å°†ä¸¤å¹…å›¾çš„ç‰¹å¾åŒ¹é…ç‚¹ä»å›¾åƒåæ ‡ç³»å˜æ¢åˆ°ä¸–ç•Œåæ ‡ç³»</span>
      <span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span> <span class="n">point1_N</span> <span class="o">=</span>
         <span class="n">camera1</span><span class="p">.</span><span class="n">ImageToWorld</span><span class="p">(</span><span class="n">image1</span><span class="p">.</span><span class="n">Point2D</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">point2D_idx1</span><span class="p">).</span><span class="n">XY</span><span class="p">());</span>
      <span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span> <span class="n">point2_N</span> <span class="o">=</span>
         <span class="n">camera2</span><span class="p">.</span><span class="n">ImageToWorld</span><span class="p">(</span><span class="n">image2</span><span class="p">.</span><span class="n">Point2D</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">point2D_idx2</span><span class="p">).</span><span class="n">XY</span><span class="p">());</span>

      <span class="c1">// ä¸‰è§’åŒ–åŒ¹é…ç‚¹ï¼Œå¾—åˆ°3Dç‚¹</span>
      <span class="k">const</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="o">&amp;</span> <span class="n">xyz</span> <span class="o">=</span>
         <span class="n">TriangulatePoint</span><span class="p">(</span><span class="n">proj_matrix1</span><span class="p">,</span> <span class="n">proj_matrix2</span><span class="p">,</span> <span class="n">point1_N</span><span class="p">,</span> <span class="n">point2_N</span><span class="p">);</span>

      <span class="c1">// æ ¹æ®æŠ•å½±çŸ©é˜µå’Œ3Dç‚¹è®¡ç®—ä¸‰è§’å‰–åˆ†è§’</span>
      <span class="k">const</span> <span class="kt">double</span> <span class="n">tri_angle</span> <span class="o">=</span>
         <span class="n">CalculateTriangulationAngle</span><span class="p">(</span><span class="n">proj_center1</span><span class="p">,</span> <span class="n">proj_center2</span><span class="p">,</span> <span class="n">xyz</span><span class="p">);</span>

      <span class="c1">// å¦‚æœä¸‰è§’å‰–åˆ†è§’ &gt;= æœ€å°ä¸‰è§’å‰–åˆ†è§’åº¦ï¼Œ ä¸”æŠ•å½±ä¹‹åçš„3Dç‚¹çš„æ·±åº¦ä¸ºæ­£ï¼Œåˆ™å°†è¯¥3Dç‚¹åŠ å…¥é‡å»º</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tri_angle</span> <span class="o">&gt;=</span> <span class="n">min_tri_angle_rad</span> <span class="o">&amp;&amp;</span>
         <span class="n">HasPointPositiveDepth</span><span class="p">(</span><span class="n">proj_matrix1</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
         <span class="n">HasPointPositiveDepth</span><span class="p">(</span><span class="n">proj_matrix2</span><span class="p">,</span> <span class="n">xyz</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">track</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">point2D_idx</span> <span class="o">=</span> <span class="n">corr</span><span class="p">.</span><span class="n">point2D_idx1</span><span class="p">;</span>
         <span class="n">track</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">point2D_idx</span> <span class="o">=</span> <span class="n">corr</span><span class="p">.</span><span class="n">point2D_idx2</span><span class="p">;</span>
         <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">AddPoint3D</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">track</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="registernextimage">
<h3>RegisterNextImage<a class="headerlink" href="#registernextimage" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>å°è¯•å°†å›¾åƒæ³¨å†Œåˆ°ç°æœ‰æ¨¡å‹ã€‚</p>
<p>è¦æ±‚ä¹‹å‰å¯¹ <code class="docutils literal notranslate"><span class="pre">RegisterInitialImagePair</span></code> çš„è°ƒç”¨æˆåŠŸã€‚</p>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper17RegisterNextImageERK7OptionsK7image_t">
<span id="_CPPv3N17IncrementalMapper17RegisterNextImageERK7OptionsK7image_t"></span><span id="_CPPv2N17IncrementalMapper17RegisterNextImageERK7OptionsK7image_t"></span><span id="IncrementalMapper::RegisterNextImage__OptionsCR.image_tC"></span>bool <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">RegisterNextImage</code><span class="sig-paren">(</span><em class="property">const</em> <a class="reference internal" href="#_CPPv4N17IncrementalMapper7OptionsE" title="IncrementalMapper::Options">Options</a> &amp;<em>options</em>, <em class="property">const</em> image_t <em>image_id</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper17RegisterNextImageERK7OptionsK7image_t" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">RegisterNextImage</span><span class="p">(</span><span class="k">const</span> <span class="n">Options</span><span class="o">&amp;</span> <span class="n">options</span><span class="p">,</span>
                                          <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>
  <span class="n">CHECK_GE</span><span class="p">(</span><span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">NumRegImages</span><span class="p">(),</span> <span class="mi">2</span><span class="p">);</span>

  <span class="n">CHECK</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Check</span><span class="p">());</span>

   <span class="c1">// å¾—åˆ°å›¾ç‰‡å’Œå¯¹åº”ç›¸æœº</span>
   <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id</span><span class="p">);</span>
   <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">CameraId</span><span class="p">());</span>

   <span class="n">CHECK</span><span class="p">(</span><span class="o">!</span><span class="n">image</span><span class="p">.</span><span class="n">IsRegistered</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Image cannot be registered multiple times&quot;</span><span class="p">;</span>

   <span class="c1">// è¯¥å›¾ç‰‡çš„å°è¯•æ³¨å†Œæ¬¡æ•°+1</span>
   <span class="n">num_reg_trials_</span><span class="p">[</span><span class="n">image_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

   <span class="c1">// å¦‚æœæ²¡æœ‰è¶³å¤Ÿå¤šçš„å¯è§ç‚¹ï¼Œåˆ™æ³¨å†Œå¤±è´¥</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">NumVisiblePoints3D</span><span class="p">()</span> <span class="o">&lt;</span>
         <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">abs_pose_min_num_inliers</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>
   <span class="c1">// å¯»æ‰¾2D-3Då¯¹åº”å…³ç³»</span>
   <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>

   <span class="k">const</span> <span class="kt">int</span> <span class="n">kCorrTransitivity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">point2D_t</span><span class="p">,</span> <span class="n">point3D_t</span><span class="o">&gt;&gt;</span> <span class="n">tri_corrs</span><span class="p">;</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector2d</span><span class="o">&gt;</span> <span class="n">tri_points2D</span><span class="p">;</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="o">&gt;</span> <span class="n">tri_points3D</span><span class="p">;</span>

   <span class="k">for</span> <span class="p">(</span><span class="n">point2D_t</span> <span class="n">point2D_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">point2D_idx</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">NumPoints2D</span><span class="p">();</span>
         <span class="o">++</span><span class="n">point2D_idx</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="n">Point2D</span><span class="o">&amp;</span> <span class="n">point2D</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">Point2D</span><span class="p">(</span><span class="n">point2D_idx</span><span class="p">);</span>
      <span class="k">const</span> <span class="n">CorrespondenceGraph</span><span class="o">&amp;</span> <span class="n">correspondence_graph</span> <span class="o">=</span>
         <span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">CorrespondenceGraph</span><span class="p">();</span>

      <span class="c1">// kCorrTransitivity = 1 ç›¸å½“äºæ‰¾åˆ°å¯¹åº”çš„åŒ¹é…ç‚¹å¯¹</span>
      <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">CorrespondenceGraph</span><span class="o">::</span><span class="n">Correspondence</span><span class="o">&gt;</span> <span class="n">corrs</span> <span class="o">=</span>
         <span class="n">correspondence_graph</span><span class="p">.</span><span class="n">FindTransitiveCorrespondences</span><span class="p">(</span>
               <span class="n">image_id</span><span class="p">,</span> <span class="n">point2D_idx</span><span class="p">,</span> <span class="n">kCorrTransitivity</span><span class="p">);</span>

      <span class="n">std</span><span class="o">::</span><span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">point3D_t</span><span class="o">&gt;</span> <span class="n">point3D_ids</span><span class="p">;</span>

      <span class="c1">// éå†æ‰€æœ‰çš„ç‰¹å¾ç‚¹å¯¹</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="nl">corr</span> <span class="p">:</span> <span class="n">corrs</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">const</span> <span class="n">Image</span><span class="o">&amp;</span> <span class="n">corr_image</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">image_id</span><span class="p">);</span>

         <span class="c1">// å¦‚æœè¯¥å¯¹åº”å›¾åƒæ²¡æœ‰è¢«æ³¨å†Œï¼Œåˆ™è·³è¿‡</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">corr_image</span><span class="p">.</span><span class="n">IsRegistered</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="k">const</span> <span class="n">Point2D</span><span class="o">&amp;</span> <span class="n">corr_point2D</span> <span class="o">=</span> <span class="n">corr_image</span><span class="p">.</span><span class="n">Point2D</span><span class="p">(</span><span class="n">corr</span><span class="p">.</span><span class="n">point2D_idx</span><span class="p">);</span>

         <span class="c1">// å¦‚æœåŒ¹é…ç‚¹æ²¡æœ‰é‡å»ºå¥½çš„3Dç‚¹ï¼Œåˆ™è·³è¿‡</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">corr_point2D</span><span class="p">.</span><span class="n">HasPoint3D</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="c1">// é¿å…é‡å¤çš„åŒ¹é…å…³ç³»</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">point3D_ids</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">corr_point2D</span><span class="p">.</span><span class="n">Point3DId</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">corr_camera</span> <span class="o">=</span>
            <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">corr_image</span><span class="p">.</span><span class="n">CameraId</span><span class="p">());</span>

         <span class="c1">// é¿å…ä¸ä¼ªé€ çš„ç›¸æœºå‚æ•°å¯¹åº”çš„å›¾åƒ</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">corr_camera</span><span class="p">.</span><span class="n">HasBogusParams</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">min_focal_length_ratio</span><span class="p">,</span>
                                     <span class="n">options</span><span class="p">.</span><span class="n">max_focal_length_ratio</span><span class="p">,</span>
                                     <span class="n">options</span><span class="p">.</span><span class="n">max_extra_param</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="k">const</span> <span class="n">Point3D</span><span class="o">&amp;</span> <span class="n">point3D</span> <span class="o">=</span>
            <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Point3D</span><span class="p">(</span><span class="n">corr_point2D</span><span class="p">.</span><span class="n">Point3DId</span><span class="p">());</span>

         <span class="c1">// å›¾åƒ2dç‚¹å’Œå¯¹åº”åŒ¹é…3dç‚¹å…³è”</span>
         <span class="n">tri_corrs</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">point2D_idx</span><span class="p">,</span> <span class="n">corr_point2D</span><span class="p">.</span><span class="n">Point3DId</span><span class="p">());</span>
         <span class="n">point3D_ids</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">corr_point2D</span><span class="p">.</span><span class="n">Point3DId</span><span class="p">());</span>
         <span class="n">tri_points2D</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">point2D</span><span class="p">.</span><span class="n">XY</span><span class="p">());</span>
         <span class="n">tri_points3D</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">point3D</span><span class="p">.</span><span class="n">XYZ</span><span class="p">());</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="c1">// ä»…å½“å­˜åœ¨å¸¦æœ‰ä¼ªé€ ç›¸æœºå‚æ•°çš„å›¾åƒæ—¶ï¼Œâ€œ next_image.num_tri_obsâ€å’Œâ€œ tri_corrs_point2D_idxs.sizeï¼ˆï¼‰â€çš„å¤§å°æ‰èƒ½ä¸åŒï¼Œ</span>
   <span class="c1">// å› æ­¤è·³è¿‡äº†ä¸€äº›2D-3Då¯¹åº”å…³ç³»ã€‚</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">tri_points2D</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span>
         <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">abs_pose_min_num_inliers</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>
   <span class="c1">// 2D-3D ä¼°è®¡</span>
   <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>

   <span class="c1">// å¦‚æœæœªæŒ‡å®šç„¦è·ï¼ˆæ‰‹åŠ¨æˆ–é€šè¿‡EXIFï¼‰å¹¶ä¸”å…ˆå‰å°šæœªä»å…¶ä»–å›¾åƒè¿›è¡Œä¼°è®¡ï¼ˆå½“å¤šä¸ªå›¾åƒå…±äº«ç›¸åŒçš„ç›¸æœºå‚æ•°æ—¶ï¼‰ï¼Œåˆ™ä»…ä¼˜åŒ–/ä¼°è®¡ç„¦è·ã€‚</span>

   <span class="n">AbsolutePoseEstimationOptions</span> <span class="n">abs_pose_options</span><span class="p">;</span>
   <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">num_threads</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">num_threads</span><span class="p">;</span>
   <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">num_focal_length_samples</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
   <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">min_focal_length_ratio</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">min_focal_length_ratio</span><span class="p">;</span>
   <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">max_focal_length_ratio</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">max_focal_length_ratio</span><span class="p">;</span>
   <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">ransac_options</span><span class="p">.</span><span class="n">max_error</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">abs_pose_max_error</span><span class="p">;</span>
   <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">ransac_options</span><span class="p">.</span><span class="n">min_inlier_ratio</span> <span class="o">=</span>
         <span class="n">options</span><span class="p">.</span><span class="n">abs_pose_min_inlier_ratio</span><span class="p">;</span>
   <span class="c1">// ä½¿ç”¨é«˜å¯ä¿¡åº¦æ¥é¿å…æå‰ç»ˆæ­¢P3P RANSACâ€”â€”â€”â€”å¤ªæ—©ç»ˆæ­¢å¯èƒ½ä¼šå¯¼è‡´æ³¨å†Œé”™è¯¯ã€‚</span>
   <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">ransac_options</span><span class="p">.</span><span class="n">min_num_trials</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
   <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">ransac_options</span><span class="p">.</span><span class="n">max_num_trials</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
   <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">ransac_options</span><span class="p">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.99999</span><span class="p">;</span>

   <span class="n">AbsolutePoseRefinementOptions</span> <span class="n">abs_pose_refinement_options</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">num_reg_images_per_camera_</span><span class="p">[</span><span class="n">image</span><span class="p">.</span><span class="n">CameraId</span><span class="p">()]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// ç›¸æœºå·²ç»å› ä¸ºå¦å¤–çš„å›¾åƒè€Œä¼˜åŒ–è¿‡ã€‚</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">camera</span><span class="p">.</span><span class="n">HasBogusParams</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">min_focal_length_ratio</span><span class="p">,</span>
                                 <span class="n">options</span><span class="p">.</span><span class="n">max_focal_length_ratio</span><span class="p">,</span>
                                 <span class="n">options</span><span class="p">.</span><span class="n">max_extra_param</span><span class="p">))</span> <span class="p">{</span>
         <span class="c1">// å…ˆå‰ä¼˜åŒ–çš„ç›¸æœºå…·æœ‰ä¼ªé€ çš„å‚æ•°ï¼Œå› æ­¤é‡ç½®å‚æ•°å¹¶å°è¯•é‡æ–°å»ºç«‹å›¾åƒã€‚</span>
         <span class="n">camera</span><span class="p">.</span><span class="n">SetParams</span><span class="p">(</span><span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">CameraId</span><span class="p">()).</span><span class="n">Params</span><span class="p">());</span>
         <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">estimate_focal_length</span> <span class="o">=</span> <span class="o">!</span><span class="n">camera</span><span class="p">.</span><span class="n">HasPriorFocalLength</span><span class="p">();</span>
         <span class="n">abs_pose_refinement_options</span><span class="p">.</span><span class="n">refine_focal_length</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
         <span class="n">abs_pose_refinement_options</span><span class="p">.</span><span class="n">refine_extra_params</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">estimate_focal_length</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
         <span class="n">abs_pose_refinement_options</span><span class="p">.</span><span class="n">refine_focal_length</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
         <span class="n">abs_pose_refinement_options</span><span class="p">.</span><span class="n">refine_extra_params</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="c1">// ç›¸æœºæœªä¼˜åŒ–è¿‡ã€‚ ä¹‹å‰å¯èƒ½å·²ç»æ›´æ”¹äº†ç›¸æœºå‚æ•°ï¼Œä½†å·²è¿‡æ»¤äº†å›¾åƒï¼Œå› æ­¤é‡ç½®ç›¸æœºå‚æ•°å¹¶å°è¯•é‡æ–°ä¼°è®¡ã€‚</span>
      <span class="n">camera</span><span class="p">.</span><span class="n">SetParams</span><span class="p">(</span><span class="n">database_cache_</span><span class="o">-&gt;</span><span class="n">Camera</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">CameraId</span><span class="p">()).</span><span class="n">Params</span><span class="p">());</span>
      <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">estimate_focal_length</span> <span class="o">=</span> <span class="o">!</span><span class="n">camera</span><span class="p">.</span><span class="n">HasPriorFocalLength</span><span class="p">();</span>
      <span class="n">abs_pose_refinement_options</span><span class="p">.</span><span class="n">refine_focal_length</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="n">abs_pose_refinement_options</span><span class="p">.</span><span class="n">refine_extra_params</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">options</span><span class="p">.</span><span class="n">abs_pose_refine_focal_length</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">abs_pose_options</span><span class="p">.</span><span class="n">estimate_focal_length</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="n">abs_pose_refinement_options</span><span class="p">.</span><span class="n">refine_focal_length</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">options</span><span class="p">.</span><span class="n">abs_pose_refine_extra_params</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">abs_pose_refinement_options</span><span class="p">.</span><span class="n">refine_extra_params</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kt">size_t</span> <span class="n">num_inliers</span><span class="p">;</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">inlier_mask</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">EstimateAbsolutePose</span><span class="p">(</span><span class="n">abs_pose_options</span><span class="p">,</span> <span class="n">tri_points2D</span><span class="p">,</span> <span class="n">tri_points3D</span><span class="p">,</span>
                              <span class="o">&amp;</span><span class="n">image</span><span class="p">.</span><span class="n">Qvec</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">.</span><span class="n">Tvec</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">camera</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">num_inliers</span><span class="p">,</span>
                              <span class="o">&amp;</span><span class="n">inlier_mask</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">num_inliers</span> <span class="o">&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">abs_pose_min_num_inliers</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

  <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>
  <span class="c1">// ä½å§¿BAä¼˜åŒ–</span>
  <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">RefineAbsolutePose</span><span class="p">(</span><span class="n">abs_pose_refinement_options</span><span class="p">,</span> <span class="n">inlier_mask</span><span class="p">,</span>
                           <span class="n">tri_points2D</span><span class="p">,</span> <span class="n">tri_points3D</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">.</span><span class="n">Qvec</span><span class="p">(),</span>
                           <span class="o">&amp;</span><span class="n">image</span><span class="p">.</span><span class="n">Tvec</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">camera</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

  <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>
  <span class="c1">// Continue tracks</span>
  <span class="c1">//////////////////////////////////////////////////////////////////////////////</span>

   <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">RegisterImage</span><span class="p">(</span><span class="n">image_id</span><span class="p">);</span>
   <span class="n">RegisterImageEvent</span><span class="p">(</span><span class="n">image_id</span><span class="p">);</span>

   <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">inlier_mask</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">inlier_mask</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
         <span class="k">const</span> <span class="n">point2D_t</span> <span class="n">point2D_idx</span> <span class="o">=</span> <span class="n">tri_corrs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">;</span>
         <span class="k">const</span> <span class="n">Point2D</span><span class="o">&amp;</span> <span class="n">point2D</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">Point2D</span><span class="p">(</span><span class="n">point2D_idx</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">point2D</span><span class="p">.</span><span class="n">HasPoint3D</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">const</span> <span class="n">point3D_t</span> <span class="n">point3D_id</span> <span class="o">=</span> <span class="n">tri_corrs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">;</span>
            <span class="k">const</span> <span class="n">TrackElement</span> <span class="nf">track_el</span><span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="n">point2D_idx</span><span class="p">);</span>
            <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">AddObservation</span><span class="p">(</span><span class="n">point3D_id</span><span class="p">,</span> <span class="n">track_el</span><span class="p">);</span>
            <span class="n">triangulator_</span><span class="o">-&gt;</span><span class="n">AddModifiedPoint3D</span><span class="p">(</span><span class="n">point3D_id</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="triangulate">
<h3>Triangulate<a class="headerlink" href="#triangulate" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>ğŸ‘‰</p>
<p><strong>TriangulateImage</strong></p>
<p>å¯¹å›¾åƒè¿›è¡Œä¸‰è§’æµ‹é‡</p>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper16TriangulateImageERKN23IncrementalTriangulator7OptionsEK7image_t">
<span id="_CPPv3N17IncrementalMapper16TriangulateImageERKN23IncrementalTriangulator7OptionsEK7image_t"></span><span id="_CPPv2N17IncrementalMapper16TriangulateImageERKN23IncrementalTriangulator7OptionsEK7image_t"></span><span id="IncrementalMapper::TriangulateImage__IncrementalTriangulator::OptionsCR.image_tC"></span>size_t <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">TriangulateImage</code><span class="sig-paren">(</span><em class="property">const</em> IncrementalTriangulator::Options &amp;<em>tri_options</em>, <em class="property">const</em> image_t <em>image_id</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper16TriangulateImageERKN23IncrementalTriangulator7OptionsEK7image_t" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">size_t</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">TriangulateImage</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">IncrementalTriangulator</span><span class="o">::</span><span class="n">Options</span><span class="o">&amp;</span> <span class="n">tri_options</span><span class="p">,</span>
      <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">triangulator_</span><span class="o">-&gt;</span><span class="n">TriangulateImage</span><span class="p">(</span><span class="n">tri_options</span><span class="p">,</span> <span class="n">image_id</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Retriangulate</strong></p>
<p>é‡æ–°ä¸‰è§’æµ‹é‡åœ¨åœºæ™¯å›¾ä¸­æœ‰å…±åŒè§‚æµ‹ç»“æœä½†ä¸ä¼šå¼•èµ·æ¼‚ç§»çš„å›¾åƒå¯¹ã€‚</p>
<p>è¦å¤„ç†åœºæ™¯æ¼‚ç§»ï¼Œæ‰€é‡‡ç”¨çš„é‡æŠ•å½±è¯¯å·®é˜ˆå€¼åº”ç›¸å¯¹è¾ƒå¤§ã€‚</p>
<ul class="simple">
<li><p>å¦‚æœé˜ˆå€¼å¤ªå¤§ï¼Œåˆ™éé²æ£’çš„BAè°ƒæ•´å°†å¤±è´¥ã€‚</p></li>
<li><p>å¦‚æœé˜ˆå€¼å¤ªå°ï¼Œå°†æ— æ³•æœ‰æ•ˆåœ°è§£å†³æ¼‚ç§»é—®é¢˜ã€‚</p></li>
</ul>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper13RetriangulateERKN23IncrementalTriangulator7OptionsE">
<span id="_CPPv3N17IncrementalMapper13RetriangulateERKN23IncrementalTriangulator7OptionsE"></span><span id="_CPPv2N17IncrementalMapper13RetriangulateERKN23IncrementalTriangulator7OptionsE"></span><span id="IncrementalMapper::Retriangulate__IncrementalTriangulator::OptionsCR"></span>size_t <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">Retriangulate</code><span class="sig-paren">(</span><em class="property">const</em> IncrementalTriangulator::Options &amp;<em>tri_options</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper13RetriangulateERKN23IncrementalTriangulator7OptionsE" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">size_t</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">Retriangulate</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">IncrementalTriangulator</span><span class="o">::</span><span class="n">Options</span><span class="o">&amp;</span> <span class="n">tri_options</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">triangulator_</span><span class="o">-&gt;</span><span class="n">Retriangulate</span><span class="p">(</span><span class="n">tri_options</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>CompleteTracks</strong></p>
<p>é€šè¿‡è¿‡æ¸¡æ€§åœ°éµå¾ªåœºæ™¯å›¾å¯¹åº”å…³ç³»æ¥å®Œæˆè½¨é“ã€‚</p>
<p>BAè°ƒæ•´åï¼Œæ­¤å‡½æ•°ç‰¹åˆ«æœ‰æ•ˆï¼Œå› ä¸ºè®¸å¤šæ‘„åƒæœºå’Œç‚¹çš„ä½ç½®å¯èƒ½å·²å¾—åˆ°æ”¹å–„ã€‚</p>
<p>å®Œæˆè½¨é“åï¼Œå¯ä»¥æ›´å¥½åœ°æ³¨å†Œæ–°å›¾åƒã€‚</p>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper14CompleteTracksERKN23IncrementalTriangulator7OptionsE">
<span id="_CPPv3N17IncrementalMapper14CompleteTracksERKN23IncrementalTriangulator7OptionsE"></span><span id="_CPPv2N17IncrementalMapper14CompleteTracksERKN23IncrementalTriangulator7OptionsE"></span><span id="IncrementalMapper::CompleteTracks__IncrementalTriangulator::OptionsCR"></span>size_t <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">CompleteTracks</code><span class="sig-paren">(</span><em class="property">const</em> IncrementalTriangulator::Options &amp;<em>tri_options</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper14CompleteTracksERKN23IncrementalTriangulator7OptionsE" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">size_t</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">CompleteTracks</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">IncrementalTriangulator</span><span class="o">::</span><span class="n">Options</span><span class="o">&amp;</span> <span class="n">tri_options</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">triangulator_</span><span class="o">-&gt;</span><span class="n">CompleteAllTracks</span><span class="p">(</span><span class="n">tri_options</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>MergeTracks</strong></p>
<p>ä½¿ç”¨åœºæ™¯å›¾å¯¹åº”å…³ç³»æ¥åˆå¹¶è½¨é“ï¼Œè¿™åœ¨BAè°ƒæ•´åæœ‰æ•ˆï¼Œå¹¶æ”¹å–„äº†åç»­BAè°ƒæ•´ä¸­çš„å†—ä½™æ€§ã€‚</p>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper11MergeTracksERKN23IncrementalTriangulator7OptionsE">
<span id="_CPPv3N17IncrementalMapper11MergeTracksERKN23IncrementalTriangulator7OptionsE"></span><span id="_CPPv2N17IncrementalMapper11MergeTracksERKN23IncrementalTriangulator7OptionsE"></span><span id="IncrementalMapper::MergeTracks__IncrementalTriangulator::OptionsCR"></span>size_t <code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">MergeTracks</code><span class="sig-paren">(</span><em class="property">const</em> IncrementalTriangulator::Options &amp;<em>tri_options</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper11MergeTracksERKN23IncrementalTriangulator7OptionsE" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">size_t</span> <span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">MergeTracks</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">IncrementalTriangulator</span><span class="o">::</span><span class="n">Options</span><span class="o">&amp;</span> <span class="n">tri_options</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">triangulator_</span><span class="o">-&gt;</span><span class="n">MergeAllTracks</span><span class="p">(</span><span class="n">tri_options</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="adjustlocalbundle">
<h3>AdjustLocalBundle<a class="headerlink" href="#adjustlocalbundle" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>è°ƒæ•´å±€éƒ¨è¿æ¥çš„å›¾åƒå’Œå‚è€ƒå›¾åƒçš„ç‚¹ã€‚</p>
<p>æ­¤å¤–ï¼Œä¼˜åŒ–æä¾›çš„3Dç‚¹ã€‚ ä»…ä¼˜åŒ–è¿æ¥åˆ°å‚è€ƒå›¾åƒçš„å›¾åƒã€‚ å¦‚æœæä¾›çš„3Dç‚¹æœªå±€éƒ¨è¿æ¥åˆ°å‚è€ƒå›¾åƒï¼Œåˆ™åœ¨è°ƒæ•´ä¸­å°†å…¶è§‚å¯Ÿå›¾åƒè®¾ç½®ä¸ºå¸¸æ•°ã€‚</p>
<dl class="cpp function">
<dt id="_CPPv4N17IncrementalMapper17AdjustLocalBundleERK7OptionsRK23BundleAdjustmentOptionsRKN23IncrementalTriangulator7OptionsEK7image_tRKNSt13unordered_setI9point3D_tEE">
<span id="_CPPv3N17IncrementalMapper17AdjustLocalBundleERK7OptionsRK23BundleAdjustmentOptionsRKN23IncrementalTriangulator7OptionsEK7image_tRKNSt13unordered_setI9point3D_tEE"></span><span id="_CPPv2N17IncrementalMapper17AdjustLocalBundleERK7OptionsRK23BundleAdjustmentOptionsRKN23IncrementalTriangulator7OptionsEK7image_tRKNSt13unordered_setI9point3D_tEE"></span><span id="IncrementalMapper::AdjustLocalBundle__OptionsCR.BundleAdjustmentOptionsCR.IncrementalTriangulator::OptionsCR.image_tC.std::unordered_set:point3D_t:CR"></span><code class="sig-prename descclassname"><a class="reference internal" href="#_CPPv417IncrementalMapper" title="IncrementalMapper">IncrementalMapper</a><code class="sig-prename descclassname">::</code></code><code class="sig-name descname">AdjustLocalBundle</code><span class="sig-paren">(</span><em class="property">const</em> <a class="reference internal" href="#_CPPv4N17IncrementalMapper7OptionsE" title="IncrementalMapper::Options">Options</a> &amp;<em>options</em>, <em class="property">const</em> BundleAdjustmentOptions &amp;<em>ba_options</em>, <em class="property">const</em> IncrementalTriangulator::Options &amp;<em>tri_options</em>, <em class="property">const</em> image_t <em>image_id</em>, <em class="property">const</em> std::unordered_set&lt;point3D_t&gt; &amp;<em>point3D_ids</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N17IncrementalMapper17AdjustLocalBundleERK7OptionsRK23BundleAdjustmentOptionsRKN23IncrementalTriangulator7OptionsEK7image_tRKNSt13unordered_setI9point3D_tEE" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a><br /></dt>
<dd></dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">LocalBundleAdjustmentReport</span>
<span class="n">IncrementalMapper</span><span class="o">::</span><span class="n">AdjustLocalBundle</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">Options</span><span class="o">&amp;</span> <span class="n">options</span><span class="p">,</span> <span class="k">const</span> <span class="n">BundleAdjustmentOptions</span><span class="o">&amp;</span> <span class="n">ba_options</span><span class="p">,</span>
      <span class="k">const</span> <span class="n">IncrementalTriangulator</span><span class="o">::</span><span class="n">Options</span><span class="o">&amp;</span> <span class="n">tri_options</span><span class="p">,</span> <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id</span><span class="p">,</span>
      <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">point3D_t</span><span class="o">&gt;&amp;</span> <span class="n">point3D_ids</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>
   <span class="n">CHECK</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Check</span><span class="p">());</span>

   <span class="n">LocalBundleAdjustmentReport</span> <span class="n">report</span><span class="p">;</span>

   <span class="c1">// æŸ¥æ‰¾ä¸ç»™å®šçš„å›¾åƒæœ‰æœ€å¤šå…¬å…±3Dç‚¹çš„å›¾åƒ</span>
   <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">local_bundle</span> <span class="o">=</span> <span class="n">FindLocalBundle</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">image_id</span><span class="p">);</span>

   <span class="c1">// ä»…åœ¨æœ‰è¿æ¥çš„å›¾åƒçš„æƒ…å†µä¸‹è¿›è¡ŒBAè°ƒæ•´</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">local_bundle</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">BundleAdjustmentConfig</span> <span class="n">ba_config</span><span class="p">;</span>
      <span class="n">ba_config</span><span class="p">.</span><span class="n">AddImage</span><span class="p">(</span><span class="n">image_id</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">image_t</span> <span class="nl">local_image_id</span> <span class="p">:</span> <span class="n">local_bundle</span><span class="p">)</span>
         <span class="n">ba_config</span><span class="p">.</span><span class="n">AddImage</span><span class="p">(</span><span class="n">local_image_id</span><span class="p">);</span>

      <span class="c1">// å¦‚æœæŒ‡å®šäº†é€‰é¡¹ï¼Œåˆ™ä¿®å¤ç°æœ‰å›¾åƒ</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">fix_existing_images</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">image_t</span> <span class="nl">local_image_id</span> <span class="p">:</span> <span class="n">local_bundle</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">existing_image_ids_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">local_image_id</span><span class="p">))</span>
               <span class="n">ba_config</span><span class="p">.</span><span class="n">SetConstantPose</span><span class="p">(</span><span class="n">local_image_id</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span>

      <span class="c1">// å½“å¹¶éæ‰€æœ‰æ³¨å†Œçš„å›¾åƒéƒ½åœ¨å½“å‰å±€éƒ¨BAä¸­æ—¶ï¼Œç¡®å®šè¦ä¿®å¤çš„æ‘„åƒæœºã€‚</span>
      <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">camera_t</span><span class="p">,</span> <span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">num_images_per_camera</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">image_t</span> <span class="nl">image_id</span> <span class="p">:</span> <span class="n">ba_config</span><span class="p">.</span><span class="n">Images</span><span class="p">())</span> <span class="p">{</span>
         <span class="k">const</span> <span class="n">Image</span><span class="o">&amp;</span> <span class="n">image</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Image</span><span class="p">(</span><span class="n">image_id</span><span class="p">);</span>
         <span class="n">num_images_per_camera</span><span class="p">[</span><span class="n">image</span><span class="p">.</span><span class="n">CameraId</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">camera_id_and_num_images_pair</span> <span class="p">:</span> <span class="n">num_images_per_camera</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">const</span> <span class="kt">size_t</span> <span class="n">num_reg_images_for_camera</span> <span class="o">=</span>
             <span class="n">num_reg_images_per_camera_</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">camera_id_and_num_images_pair</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">camera_id_and_num_images_pair</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;</span> <span class="n">num_reg_images_for_camera</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ba_config</span><span class="p">.</span><span class="n">SetConstantCamera</span><span class="p">(</span><span class="n">camera_id_and_num_images_pair</span><span class="p">.</span><span class="n">first</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span>

      <span class="c1">// ä¿®å¤7è‡ªç”±åº¦ï¼Œä»¥é¿å…åœ¨BAè°ƒæ•´ä¸­å‡ºç°æ¯”ä¾‹/æ—‹è½¬/å¹³ç§»æ¼‚ç§»</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">local_bundle</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">ba_config</span><span class="p">.</span><span class="n">SetConstantPose</span><span class="p">(</span><span class="n">local_bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
         <span class="n">ba_config</span><span class="p">.</span><span class="n">SetConstantTvec</span><span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">local_bundle</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id1</span> <span class="o">=</span> <span class="n">local_bundle</span><span class="p">[</span><span class="n">local_bundle</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
         <span class="k">const</span> <span class="n">image_t</span> <span class="n">image_id2</span> <span class="o">=</span> <span class="n">local_bundle</span><span class="p">[</span><span class="n">local_bundle</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>
         <span class="n">ba_config</span><span class="p">.</span><span class="n">SetConstantPose</span><span class="p">(</span><span class="n">image_id1</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">options</span><span class="p">.</span><span class="n">fix_existing_images</span> <span class="o">||</span>
             <span class="o">!</span><span class="n">existing_image_ids_</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">image_id2</span><span class="p">))</span> <span class="p">{</span>
           <span class="n">ba_config</span><span class="p">.</span><span class="n">SetConstantTvec</span><span class="p">(</span><span class="n">image_id2</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">});</span>
         <span class="p">}</span>
      <span class="p">}</span>

      <span class="c1">// Make sure, we refine all new and short-track 3D points, no matter if</span>
      <span class="c1">// they are fully contained in the local image set or not. Do not include</span>
      <span class="c1">// long track 3D points as they are usually already very stable and adding</span>
      <span class="c1">// to them to bundle adjustment and track merging/completion would slow</span>
      <span class="c1">// down the local bundle adjustment significantly.</span>

      <span class="c1">// ç¡®ä¿å®Œå–„æ‰€æœ‰æ–°çš„å’ŒçŸ­è½¨é“çš„3Dç‚¹ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦å®Œå…¨åŒ…å«åœ¨å±€éƒ¨å›¾åƒé›†ä¸­ã€‚</span>
      <span class="c1">// æ³¨æ„: ä¸è¦åŒ…æ‹¬é•¿è·ç¦»3Dç‚¹ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸å·²ç»éå¸¸ç¨³å®šï¼Œå°†å®ƒä»¬æ·»åŠ åˆ°BAè°ƒæ•´ä¸­çš„è½¨é“åˆå¹¶/å®Œæˆä¼šå¤§å¤§å‡æ…¢å±€éƒ¨BAè°ƒæ•´çš„é€Ÿåº¦ã€‚</span>
      <span class="n">std</span><span class="o">::</span><span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">point3D_t</span><span class="o">&gt;</span> <span class="n">variable_point3D_ids</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">point3D_t</span> <span class="nl">point3D_id</span> <span class="p">:</span> <span class="n">point3D_ids</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">const</span> <span class="n">Point3D</span><span class="o">&amp;</span> <span class="n">point3D</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">Point3D</span><span class="p">(</span><span class="n">point3D_id</span><span class="p">);</span>
         <span class="k">const</span> <span class="kt">size_t</span> <span class="n">kMaxTrackLength</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">point3D</span><span class="p">.</span><span class="n">HasError</span><span class="p">()</span> <span class="o">||</span> <span class="n">point3D</span><span class="p">.</span><span class="n">Track</span><span class="p">().</span><span class="n">Length</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">kMaxTrackLength</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ba_config</span><span class="p">.</span><span class="n">AddVariablePoint</span><span class="p">(</span><span class="n">point3D_id</span><span class="p">);</span>
            <span class="n">variable_point3D_ids</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">point3D_id</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span>

      <span class="c1">// è°ƒæ•´å±€éƒ¨bundle</span>
      <span class="n">BundleAdjuster</span> <span class="n">bundle_adjuster</span><span class="p">(</span><span class="n">ba_options</span><span class="p">,</span> <span class="n">ba_config</span><span class="p">);</span>
      <span class="n">bundle_adjuster</span><span class="p">.</span><span class="n">Solve</span><span class="p">(</span><span class="n">reconstruction_</span><span class="p">);</span>

      <span class="n">report</span><span class="p">.</span><span class="n">num_adjusted_observations</span> <span class="o">=</span>
         <span class="n">bundle_adjuster</span><span class="p">.</span><span class="n">Summary</span><span class="p">().</span><span class="n">num_residuals</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

      <span class="c1">// å°†å®Œå–„çš„è½¨é“ä¸å…¶ä»–ç°æœ‰ç‚¹åˆå¹¶</span>
      <span class="n">report</span><span class="p">.</span><span class="n">num_merged_observations</span> <span class="o">=</span>
         <span class="n">triangulator_</span><span class="o">-&gt;</span><span class="n">MergeTracks</span><span class="p">(</span><span class="n">tri_options</span><span class="p">,</span> <span class="n">variable_point3D_ids</span><span class="p">);</span>

      <span class="c1">// å®Œæ•´çš„è½¨é“å¯èƒ½åœ¨å®Œå–„ç›¸æœºä½å§¿å’Œè¿›è¡ŒBAè°ƒæ•´ä¸­çš„æ ¡å‡†ä¹‹å‰è¿›è¡Œä¸‰è§’åŒ–ä¼šå¤±è´¥</span>
      <span class="c1">// è¿™æ ·å¯ä»¥é¿å…å¯¹æŸäº›ç‚¹è¿›è¡Œè¿‡æ»¤ï¼Œå¹¶æœ‰åŠ©äºåç»­çš„å›¾åƒé…å‡†</span>
      <span class="n">report</span><span class="p">.</span><span class="n">num_completed_observations</span> <span class="o">=</span>
         <span class="n">triangulator_</span><span class="o">-&gt;</span><span class="n">CompleteTracks</span><span class="p">(</span><span class="n">tri_options</span><span class="p">,</span> <span class="n">variable_point3D_ids</span><span class="p">);</span>
      <span class="n">report</span><span class="p">.</span><span class="n">num_completed_observations</span> <span class="o">+=</span>
         <span class="n">triangulator_</span><span class="o">-&gt;</span><span class="n">CompleteImage</span><span class="p">(</span><span class="n">tri_options</span><span class="p">,</span> <span class="n">image_id</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="c1">// è¿‡æ»¤ä¿®æ”¹çš„å›¾åƒå’Œæ‰€æœ‰æ›´æ”¹çš„3Dç‚¹ï¼Œä»¥ç¡®ä¿æ¨¡å‹ä¸­æ²¡æœ‰å¼‚å¸¸ç‚¹ã€‚</span>
   <span class="c1">// è¿™å°†å¯¼è‡´é‡å¤å·¥ä½œï¼Œå› ä¸ºè®¸å¤šæä¾›çš„3Dç‚¹ä¹Ÿå¯èƒ½åŒ…å«åœ¨è°ƒæ•´åçš„å›¾åƒä¸­ã€‚</span>
   <span class="n">std</span><span class="o">::</span><span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">image_t</span><span class="o">&gt;</span> <span class="n">filter_image_ids</span><span class="p">;</span>
   <span class="n">filter_image_ids</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">image_id</span><span class="p">);</span>
   <span class="n">filter_image_ids</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">local_bundle</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">local_bundle</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
   <span class="n">report</span><span class="p">.</span><span class="n">num_filtered_observations</span> <span class="o">=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">FilterPoints3DInImages</span><span class="p">(</span>
      <span class="n">options</span><span class="p">.</span><span class="n">filter_max_reproj_error</span><span class="p">,</span> <span class="n">options</span><span class="p">.</span><span class="n">filter_min_tri_angle</span><span class="p">,</span>
      <span class="n">filter_image_ids</span><span class="p">);</span>
   <span class="n">report</span><span class="p">.</span><span class="n">num_filtered_observations</span> <span class="o">+=</span> <span class="n">reconstruction_</span><span class="o">-&gt;</span><span class="n">FilterPoints3D</span><span class="p">(</span>
      <span class="n">options</span><span class="p">.</span><span class="n">filter_max_reproj_error</span><span class="p">,</span> <span class="n">options</span><span class="p">.</span><span class="n">filter_min_tri_angle</span><span class="p">,</span>
      <span class="n">point3D_ids</span><span class="p">);</span>

   <span class="k">return</span> <span class="n">report</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">æ³¨æ„</p>
<p>æ²¡çœ‹æ‡‚ï¼Œ æœ‰ç©ºå†çœ‹ã€‚</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../../../../theiasfm.html" class="btn btn-neutral float-right" title="ğŸ‘ TheiaSfM" accesskey="n" rel="next">ä¸‹ä¸€é¡µ <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../../../c_sfm.html" class="btn btn-neutral float-left" title="SfM Pipeline" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> ä¸Šä¸€é¡µ</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; ç‰ˆæƒæ‰€æœ‰ 2021, linzzz.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>